<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="description" content="A quality assessment and monitoring dashboard for the ICEA LION GROUP contact centre.">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QA Dashboard - ICEA LION GROUP</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.0/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; color: #1f2937; margin: 0; opacity: 0; transition: opacity 0.5s ease-in-out; }
        body.loaded { opacity: 1; }
        .main-nav { width: 125px; background-color: #000080; height: 100vh; position: fixed; top: 0; left: 0; z-index: 100; box-shadow: 2px 0 5px rgba(0,0,0,0.1); display: flex; flex-direction: column; justify-content: space-between; }
        .sidebar ul { list-style: none; margin: 0; padding: 0; flex-grow: 1; margin-top: 48px; }
        .sidebar ul li a { color: white; text-decoration: none; font-weight: 500; padding: 0.75rem 0.5rem; display: flex; flex-direction: column; align-items: center; gap: 0.25rem; font-size: 0.75rem; text-align: center; transition: background-color 0.3s ease; }
        .sidebar ul li a:hover, .sidebar ul li a.active { background-color: #000050; }
        .logout-button { background-color: #f57c00; color: white; padding: 0.5rem 0.75rem; border-radius: 0.375rem; font-weight: 600; cursor: pointer; border: none; transition: background-color 0.3s ease; margin: 1rem auto; width: calc(100% - 2rem); font-size: 0.75rem; }
        .logout-button:hover { background-color: #e65100; }
        .top-header { position: fixed; top: 0; left: 0; width: 100%; height: 48px; background-color: #000080; color: white; display: flex; align-items: center; justify-content: space-between; font-size: 1.125rem; font-weight: 600; z-index: 1000; box-shadow: 0 2px 4px rgba(0,0,0,0.2); padding: 0 1rem; }
        .top-header img { height: 40px; width: auto; }
        .content-section { margin-left: 125px; margin-top: 48px; width: calc(100% - 125px); padding: 1.5rem; }
        .dashboard-card { background-color: white; border-radius: 0.5rem; padding: 1.5rem; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .hidden { display: none !important; }
        .spinner { border: 4px solid rgba(0,0,0,0.1); border-left-color: #1a73e8; border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        /* Login Page Specific Styles */
        .login-page-wrapper { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; display: flex; align-items: center; justify-content: center; background: linear-gradient(to right, #e0eafc, #cfdef3); z-index: 2000; opacity: 0; visibility: hidden; transition: opacity 0.3s ease, visibility 0.3s ease; }
        .login-page-wrapper.visible { opacity: 1; visibility: visible; }
        .login-container { display: flex; width: 100%; max-width: 900px; background-color: white; border-radius: 1rem; box-shadow: 0 10px 25px rgba(0,0,0,0.1); overflow: hidden; }
        .login-branding { flex-basis: 50%; background-image: linear-gradient(rgba(0, 0, 128, 0.7), rgba(0, 0, 128, 0.7)), url('https://images.pexels.com/photos/8867432/pexels-photo-8867432.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1'); background-size: cover; background-position: center; color: white; padding: 3rem; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; }
        .login-branding h1 { font-size: 1.75rem; font-weight: 700; margin-bottom: 0.5rem; }
        .login-branding p { font-size: 1rem; color: rgba(255,255,255,0.8); }
        .login-form-container { flex-basis: 50%; padding: 3rem; display: flex; flex-direction: column; justify-content: center; }
        .login-form-container h2 { font-size: 1.5rem; font-weight: 600; color: #1f2937; margin-bottom: 2rem; text-align: center; }
        .input-group { position: relative; margin-bottom: 1.5rem; }
        .input-group i { position: absolute; left: 1rem; top: 50%; transform: translateY(-50%); color: #9ca3af; }
        .input-group input { width: 100%; padding: 0.75rem 1rem 0.75rem 3rem; border: 1px solid #d1d5db; border-radius: 0.5rem; }
        #loginButton { width: 100%; padding: 0.75rem 1rem; border: none; border-radius: 0.5rem; background-color: #1a73e8; color: white; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 0.5rem; }
        #loginButton:disabled { background-color: #9ca3af; cursor: not-allowed; }
        #loginButton .spinner { width: 20px; height: 20px; border-left-color: #ffffff; margin: 0; }
        .login-links { display: flex; justify-content: space-between; align-items: center; margin-top: 1rem; font-size: 0.875rem; }
        .login-links a { color: #1a73e8; text-decoration: none; }
        .login-links a:hover { text-decoration: underline; }
    </style>
</head>
<body>
    <header class="top-header">
        <span class="text-xl font-semibold">ICEA LION QUALITY DASHBOARD</span>
        <img id="header-logo" src="https://placehold.co/120x40/000080/FFFFFF?text=ICEA" alt="Company Logo">
    </header>

    <div class="login-page-wrapper" id="loginPage">
        <div class="login-container">
            <div class="login-branding">
                <h1>Quality Management System</h1>
                <p>Monitoring Excellence in Every Interaction.</p>
            </div>
            <div class="login-form-container">
                <h2 class="mt-8">ICEA Contact Centre QMS</h2>
                <form id="loginForm">
                    <div class="input-group">
                        <i class="fas fa-user"></i>
                        <input type="text" id="username" name="username" required placeholder="Username" autocomplete="username">
                    </div>
                    <div class="input-group">
                        <i class="fas fa-lock"></i>
                        <input type="password" id="password" name="password" required placeholder="Password" autocomplete="current-password">
                    </div>
                    <button type="submit" id="loginButton">
                        <span id="loginButtonText">Login</span>
                        <div id="loginSpinner" class="spinner hidden"></div>
                    </button>
                    <div id="loginMessage" class="text-red-600 text-sm text-center mt-4 hidden"></div>
                    <div class="login-links">
                        <a href="#">Forgot Password?</a>
                        <a href="#">Sign Up</a>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <nav class="main-nav" id="mainNav" style="display: none;">
        <div class="sidebar">
            <ul>
                <li><a href="#" id="homeTab" class="active"><i class="fas fa-home"></i> Home</a></li>
                <li><a href="#" id="reportsTab"><i class="fas fa-chart-bar"></i> Dashboard</a></li>
                <li><a href="#" id="auditFormTab"><i class="fas fa-file-alt"></i> Evaluation Form</a></li>
                <li><a href="#" id="myEvaluationsTab"><i class="fas fa-user-check"></i> My Evaluations</a></li>
                <li><a href="#" id="npsTab"><i class="fas fa-comments"></i> NPS</a></li>
                <li><a href="#" id="autofailsTab"><i class="fas fa-exclamation-triangle"></i> Autofails</a></li>
                <li><a href="#" id="databaseTab"><i class="fas fa-database"></i> Database</a></li>
                <li><a href="#" id="shareResponseTab"><i class="fas fa-share-square"></i> Share</a></li>
                <li><a href="#" id="usersTab"><i class="fas fa-users"></i> Users</a></li>
                <li><a href="#" id="logoTab"><i class="fas fa-image"></i> Logo</a></li>
            </ul>
            <button id="logoutBtn" class="logout-button">Logout</button>
        </div>
    </nav>

    <main id="mainContent" class="hidden">
        <div id="homeContent" class="content-section"></div>
        <div id="reportsContent" class="content-section hidden"></div>
        <div id="auditFormContent" class="content-section hidden"></div>
        <div id="myEvaluationsContent" class="content-section hidden"></div>
        <div id="npsContent" class="content-section hidden"></div>
        <div id="autofailsContent" class="content-section hidden"></div>
        <div id="databaseContent" class="content-section hidden"></div>
        <div id="shareResponseContent" class="content-section hidden"></div>
        <div id="usersContent" class="content-section hidden"></div>
        <div id="logoContent" class="content-section hidden"></div>
    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-auth.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCw4nE6cvBJ9QmPp8wxyL-Jdm6hWQ0dVjs",
            authDomain: "icea-lion-qa.firebaseapp.com",
            projectId: "icea-lion-qa",
            storageBucket: "icea-lion-qa.appspot.com",
            messagingSenderId: "820082472004",
            appId: "1:820082472004:web:8caddf941e1b5b6dfaf811",
        };
        
        const appId = (typeof __app_id !== 'undefined' && __app_id) ? __app_id : firebaseConfig.appId;
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        const LOGO_DOC_REF = doc(db, `artifacts/${appId}/public/data/logo`, 'logo_settings');
        const pageCache = {};

        async function loadPage(page) {
            const container = document.getElementById(`${page}Content`);
            if (pageCache[page]) {
                container.innerHTML = pageCache[page];
                executeScripts(pageCache[page]);
                return;
            }
            try {
                const response = await fetch(`${page}.html`);
                if (!response.ok) throw new Error(`Could not load ${page}.html`);
                const text = await response.text();
                
                pageCache[page] = text;
                container.innerHTML = text;
                executeScripts(text);

            } catch (error) {
                console.error(`Failed to fetch page: ${page}`, error);
                container.innerHTML = `<div class="text-center p-8"><h2 class="text-2xl text-red-500">Error</h2><p>Could not load the requested page.</p></div>`;
            }
        }

        function executeScripts(htmlContent) {
            const parser = new DOMParser();
            const doc = parser.parseFromString(htmlContent, 'text/html');
            const scripts = doc.querySelectorAll('script[type="module"]');
            scripts.forEach(script => {
                const newScript = document.createElement('script');
                newScript.type = 'module';
                newScript.textContent = script.textContent;
                document.body.appendChild(newScript).parentNode.removeChild(newScript);
            });
        }

        function showTab(tabId) {
            document.querySelectorAll('.content-section').forEach(s => s.classList.add('hidden'));
            document.querySelectorAll('.sidebar a').forEach(a => a.classList.remove('active'));
            
            const contentEl = document.getElementById(`${tabId}Content`);
            const tabEl = document.getElementById(`${tabId}Tab`);

            if(contentEl) contentEl.classList.remove('hidden');
            if(tabEl) tabEl.classList.add('active');
        }

        async function navigate(page) {
            await loadPage(page);
            showTab(page);
        }
        
        async function loadCurrentLogo() {
            try {
                const docSnap = await getDoc(LOGO_DOC_REF);
                if (docSnap.exists() && docSnap.data().url) {
                    document.getElementById('header-logo').src = docSnap.data().url;
                }
            } catch (error) {
                console.error("Error loading current logo:", error);
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            const loginPage = document.getElementById('loginPage');
            const mainContent = document.getElementById('mainContent');
            const mainNav = document.getElementById('mainNav');
            const loginForm = document.getElementById('loginForm');

            onAuthStateChanged(auth, user => {
                if (user) {
                    loginPage.classList.remove('visible');
                    mainContent.classList.remove('hidden');
                    mainNav.style.display = 'flex';
                    loadCurrentLogo();
                    if(!document.querySelector('.sidebar a.active') || document.getElementById('homeContent').innerHTML === '') {
                        navigate('home');
                    }
                } else {
                    loginPage.classList.add('visible');
                    mainContent.classList.add('hidden');
                    mainNav.style.display = 'none';
                }
                document.body.classList.add('loaded');
            });

            loginForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                const loginMessage = document.getElementById('loginMessage');
                const loginButton = document.getElementById('loginButton');
                const loginSpinner = document.getElementById('loginSpinner');
                const loginButtonText = document.getElementById('loginButtonText');

                loginButton.disabled = true;
                loginSpinner.classList.remove('hidden');
                loginButtonText.textContent = "Logging In...";
                loginMessage.classList.add('hidden');

                try {
                    await signInWithEmailAndPassword(auth, email, password);
                } catch (error) {
                    loginMessage.textContent = error.message;
                    loginMessage.classList.remove('hidden');
                } finally {
                    loginButton.disabled = false;
                    loginSpinner.classList.add('hidden');
                    loginButtonText.textContent = "Login";
                }
            });

            document.getElementById('homeTab').addEventListener('click', (e) => { e.preventDefault(); navigate('home'); });
            document.getElementById('reportsTab').addEventListener('click', (e) => { e.preventDefault(); navigate('Dashboard'); });
            document.getElementById('databaseTab').addEventListener('click', (e) => { e.preventDefault(); navigate('database'); });
            document.getElementById('autofailsTab').addEventListener('click', (e) => { e.preventDefault(); navigate('autofails'); });
            document.getElementById('npsTab').addEventListener('click', (e) => { e.preventDefault(); navigate('nps'); });
            document.getElementById('logoTab').addEventListener('click', (e) => { e.preventDefault(); navigate('logo'); });
            
            document.getElementById('logoutBtn').addEventListener('click', () => signOut(auth));
        });
    </script>
</body>
</html>
