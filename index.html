<!DOCTYPE html>

<html lang="en">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Quality Assessment Form - ICEA LION GROUP</title>

    <!-- Tailwind CSS CDN -->

    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts - Inter -->

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    

    <!-- Link to your custom CSS file (for reports page and shared nav/footer if any) -->

    <link rel="stylesheet" href="style.css">



    <!-- jsPDF and html2canvas for PDF generation -->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <!-- Font Awesome for icons -->

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">





    <style>

        /* Custom styles for body and utility classes not directly in Tailwind's default */

        body {

            font-family: 'Inter', sans-serif;

        }

        /* Custom blue for ICEALION branding, as used in your login and form header */

        .icealion-blue {

            background-color: #1a73e8;

            color: white;

        }

        .icealion-orange-text {

            color: #f57c00;

        }

        .error-message {

            color: #dc2626; /* Red color for error messages */

            font-size: 0.875rem; /* Equivalent to text-sm */

            margin-top: 0.5rem; /* Equivalent to mt-2 */

            text-align: center;

        }



        /* Styles for section headers background */

        .section-header-bg {

            background-color: #1a73e8; /* A shade of blue for section headers */

        }

        /* Styles for numbered icons background colors */

        .icon-bg-orange { background-color: #f57c00; }

        .icon-bg-blue { background-color: #2196f3; }

        .icon-bg-green { background-color: #4caf50; }

        .icon-bg-yellow { background-color: #ffc107; }



        /* Row background colors for zebra striping effect */

        .form-row-light { background-color: #f9fafb; }

        .form-row-dark { background-color: #edf2f7; }



        /* Specific adjustments for input padding in grid layout */

        .form-grid-input {

            padding: 8px; /* Standard padding for basic info inputs */

        }



        /* Adjustments for main content display, positioned relative to body flow */

        body > .form-container,

        body > .reports-container {

            margin-top: 20px; /* Space from top */

            margin-bottom: 20px; /* Space at bottom */

            padding-left: 20px;

            padding-right: 20px;

            box-sizing: border-box; /* Ensure padding is included in element's total width */

        }



        /* Ensure main content containers are centered horizontally within the body flow */

        body {

            display: flex;

            flex-direction: column;

            align-items: center; /* Center content horizontally */

        }



        /* Progress bar (if applicable, though not directly used now, kept from snippet) */

        .progress-bar-container {

            background-color: #e0e0e0;

            border-radius: 9999px;

            overflow: hidden;

        }

        .progress-bar {

            background-color: #4CAF50;

            height: 10px;

            width: 24%; /* Example width, will be dynamic */

            border-radius: 9999px;

        }

    </style>

</head>

<body class="bg-gray-100 min-h-screen">

    <!-- Navigation Menu (Always present if logged in) -->

    <nav class="main-nav" id="mainNav">

        <ul>

            <li><a href="index.html" class="active"><i class="fas fa-file-alt"></i> Audit Form</a></li>

            <li><a href="reports.html"><i class="fas fa-chart-bar"></i> Reports</a></li>

            <li><a href="admin.html"><i class="fas fa-cog"></i> Admin</a></li>

        </ul>

        <button id="logoutBtn" class="logout-button">Logout</button>

    </nav>



    <!-- Login Page (always positioned absolutely to overlay everything) -->

    <div class="login-container absolute inset-0 flex items-center justify-center p-4 md:p-8 z-10" id="loginPage">

        <div class="container mx-auto bg-white shadow-lg rounded-lg overflow-hidden max-w-md">

            <div class="icealion-blue p-6 rounded-t-lg text-center">

                <h1 class="text-2xl font-semibold">ICEALION GROUP Login</h1>

            </div>



            <form id="loginForm" class="p-8 space-y-6">

                <div>

                    <label for="username" class="block text-sm font-medium text-gray-700">Username</label>

                    <input type="text" id="username" name="username" 

                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50 p-2 border" 

                           required placeholder="Enter your username">

                </div>

                <div>

                    <label for="password" class="block text-sm font-medium text-gray-700">Password</label>

                    <input type="password" id="password" name="password" 

                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50 p-2 border" 

                           required placeholder="Enter your password">

                </div>

                <button type="submit" 

                        class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-md shadow-md transition duration-300 ease-in-out">

                    Login

                </button>

                <div id="loginMessage" class="error-message hidden"></div>

            </form>

        </div>

    </div>



    <!-- Main Form Content (Initially Hidden) -->

    <!-- This entire div is the form-container with the new layout -->

    <div class="container mx-auto bg-white shadow-lg rounded-lg overflow-hidden max-w-4xl" id="mainFormContent" style="display: none;">

        <div class="icealion-blue p-4 flex items-center justify-between">

            <div class="text-xl font-semibold">Quality Assessment Form - ICEALION GROUP Contact Centre</div>

            <!-- Using a placeholder logo. Replace with your actual logo if needed -->

            <img src="https://placehold.co/120x40/1a73e8/FFFFFF?text=ICEALION" alt="ICEALION Logo" class="h-10 rounded-md">

        </div>



        <div class="p-6 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">

            <div>

                <label for="contact-id" class="block text-sm font-medium text-gray-700">Contact ID</label>

                <input type="text" id="contact-id" name="contactId" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 p-2 border form-grid-input" required>

                <p class="text-red-500 text-xs italic hidden" id="contact-id-error">This field is required.</p>

            </div>

            <div>

                <label for="client-name" class="block text-sm font-medium text-gray-700">Client Name</label>

                <input type="text" id="client-name" name="clientName" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 p-2 border form-grid-input" placeholder="e.g., John Doe" required>

                <p class="text-red-500 text-xs italic hidden" id="client-name-error">This field is required.</p>

            </div>

            <div>

                <label for="cer-name" class="block text-sm font-medium text-gray-700">CER Name</label>

                <select id="cer-name" name="cerName" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 p-2 border form-grid-input" required>

                    <option value="" disabled selected>Select CER</option>

                    <option value="Ann Nyokabi">Ann Nyokabi</option>

                    <option value="Cliff Kiyaka">Cliff Kiyaka</option>

                    <option value="Edith watahi">Edith watahi</option>

                    <option value="Faith Irungu">Faith Irungu</option>

                    <option value="Ian Wanyagi">Ian Wanyagi</option>

                    <option value="Kelvin Nyagaka">Kelvin Nyagaka</option>

                    <option value="Lawrence Ochola">Lawrence Ochola</option>

                    <option value="Linnet Chege">Linnet Chege</option>

                    <option value="Margaret Mukulu">Margaret Mukulu</option>

                    <option value="Bonface Masiaga">Bonface Masiaga</option>

                    <option value="Maureen Ongola">Maureen Ongola</option>

                    <option value="Melinda Omballa">Melinda Omballa</option>

                    <option value="Nancy Wanjiku">Nancy Wanjiku</option>

                    <option value="Patricia Mumbi">Patricia Mumbi</option>

                    <option value="Philly Osikeh">Philly Osikeh</option>

                    <option value="Phina Owiti">Phina Owiti</option>

                    <option value="Sharon Wambugu">Sharon Wambugu</option>

                    <option value="Victor Kibet">Victor Kibet</option>

                    <option value="Harlod Mwiti">Harlod Mwiti</option>

                </select>

                <p class="text-red-500 text-xs italic hidden" id="cer-name-error">This field is required.</p>

            </div>

            <div>

                <label for="cer-role" class="block text-sm font-medium text-gray-700">CER Role</label>

                <select id="cer-role" name="cerRole" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 p-2 border form-grid-input" required>

                    <option value="" disabled selected>Select Role</option>

                    <option value="Outbound Sales">Outbound Sales</option>

                    <option value="Onboarding outbound">Onboarding outbound</option>

                    <option value="Social Media">Social Media</option>

                    <option value="Live Chat">Live Chat</option>

                    <option value="Inbound">Inbound</option>

                    <option value="Email">Email</option>

                    <option value="Digital troubleshooting">Digital troubleshooting</option>

                    <option value="SMS">SMS</option>

                    <option value="NPS outbound">NPS outbound</option>

                    <option value="Reviewed case handling">Reviewed case handling</option>

                </select>

                <p class="text-red-500 text-xs italic hidden" id="cer-role-error">This field is required.</p>

            </div>

            <div>

                <label for="call-date-time" class="block text-sm font-medium text-gray-700">Call Date and Time</label>

                <input type="datetime-local" id="call-date-time" name="callDateTime" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 p-2 border form-grid-input" required>

                <p class="text-red-500 text-xs italic hidden" id="call-date-time-error">This field is required.</p>

            </div>

            <div>

                <label for="reviewer-name" class="block text-sm font-medium text-gray-700">Reviewer's Name</label>

                <select id="reviewer-name" name="reviewerName" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 p-2 border form-grid-input" required>

                    <option value="" disabled selected>Select Reviewer</option>

                    <option value="Rebecca Nduta">Rebecca Nduta</option>

                    <option value="Lawrence Ochola">Lawrence Ochola</option>

                    <option value="Other">Other</option>

                </select>

                <input type="text" id="other-reviewer-name" name="otherReviewerName" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 p-2 border form-grid-input hidden" placeholder="Enter Reviewer Name">

                <p class="text-red-500 text-xs italic hidden" id="reviewer-name-error">This field is required.</p>

            </div>

            <div>

                <label for="autofail-type" class="block text-sm font-medium text-gray-700">Auto Fail Type</label>

                <select id="autofail-type" name="autofailType" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 p-2 border form-grid-input">

                    <option value="">Select Autofail Type</option>

                    <option value="First Contact Resolution">First Contact Resolution</option>

                    <option value="KYC">KYC</option>

                    <option value="Data Capture">Data Capture</option>

                    <option value="Follow-up & action items">Follow-up & action items</option>

                </select>

            </div>

            <div>

                <label for="review-date" class="block text-sm font-medium text-gray-700">Evaluation Date</label>

                <input type="date" id="review-date" name="evaluationDate" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-ring-indigo-200 focus:ring-opacity-50 p-2 border form-grid-input" required>

                <p class="text-red-500 text-xs italic hidden" id="review-date-error">This field is required.</p>

            </div>

            <div>

                <label for="duration" class="block text-sm font-medium text-gray-700">Call Duration</label>

                <input type="text" id="duration" name="callDuration" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 p-2 border form-grid-input" placeholder="e.g., 30 mins">

            </div>

        </div>



        <div class="p-4 rounded-lg shadow-sm flex flex-col items-center justify-center space-y-2 bg-gray-50 mx-6 mb-4">

            <div class="text-sm font-medium text-gray-600">Scores:</div>

            <div class="flex justify-around w-full gap-2">

                <div class="flex-1 text-center bg-gray-50 p-2 rounded-md">

                    <div class="text-xs font-medium text-gray-600 mb-1">Overall Score</div>

                    <div class="text-xl font-bold text-blue-600" id="overall-score-display">0%</div>

                </div>

                <div class="flex-1 text-center bg-gray-50 p-2 rounded-md">

                    <div class="text-xs font-medium text-gray-600 mb-1">Business & Compliance Accuracy</div>

                    <div class="text-xl font-bold text-blue-600" id="business-compliance-accuracy">0%</div>

                </div>

            </div>

        </div>



        <form id="assessment-form">

            <!-- Questions will be dynamically updated here -->

            <div class="mt-4">

                <div class="section-header-bg text-white p-3 font-semibold flex items-center gap-2">

                    <i class="fas fa-user tile-icon"></i> <!-- Font Awesome icon for Customer Experience -->

                    CUSTOMER EXPERIENCE

                </div>

                <div class="p-4">

                    <div class="grid grid-cols-12 gap-2 text-sm font-medium text-gray-700 mb-2">

                        <div class="col-span-6">Description</div>

                        <div class="col-span-2 text-center">Rating</div>

                        <div class="col-span-1 text-center">Weight</div>

                        <div class="col-span-1 text-center">Pnts</div>

                        <div class="col-span-2">Remarks</div>

                    </div>



                    <!-- Question 1 -->

                    <div class="grid grid-cols-12 gap-2 py-2 items-center rounded-md form-row-light mb-2 p-2" data-question-id="q1">

                        <div class="col-span-6 flex items-center gap-2">

                            <span class="icon-bg-orange rounded-full p-1 text-white text-xs inline-flex items-center justify-center w-6 h-6 icon-number">1</span>

                            <span class="description-text"></span>

                        </div>

                        <div class="col-span-2">

                            <select name="rating_q1" class="w-full rounded-md border-gray-300 shadow-sm p-1 text-center border question-rating-select">

                                <option value="" disabled selected>None</option>

                                <option value="Yes">Yes</option>

                                <option value="No">No</option>

                            </select>

                        </div>

                        <div class="col-span-1 text-center weight-display" data-weightage="0"></div> 

                        <div class="col-span-1 text-center">

                            <input type="number" name="points_q1" class="w-full text-center p-1 border rounded-md question-points-input" value="0" readonly placeholder="0">

                        </div>

                        <div class="col-span-2">

                            <textarea name="remarks_q1" rows="1" class="w-full rounded-md border-gray-300 shadow-sm p-1 border question-remarks-textarea"></textarea>

                        </div>

                    </div>

                    <!-- Question 2 -->

                    <div class="grid grid-cols-12 gap-2 py-2 items-center rounded-md form-row-dark mb-2 p-2" data-question-id="q2">

                        <div class="col-span-6 flex items-center gap-2">

                            <span class="icon-bg-blue rounded-full p-1 text-white text-xs inline-flex items-center justify-center w-6 h-6 icon-number">2</span>

                            <span class="description-text"></span>

                        </div>

                        <div class="col-span-2">

                            <select name="rating_q2" class="w-full rounded-md border-gray-300 shadow-sm p-1 text-center border question-rating-select">

                                <option value="" disabled selected>None</option>

                                <option value="Yes">Yes</option>

                                <option value="No">No</option>

                            </select>

                        </div>

                        <div class="col-span-1 text-center weight-display" data-weightage="0"></div> 

                        <div class="col-span-1 text-center">

                            <input type="number" name="points_q2" class="w-full text-center p-1 border rounded-md question-points-input" value="0" readonly placeholder="0">

                        </div>

                        <div class="col-span-2">

                            <textarea name="remarks_q2" rows="1" class="w-full rounded-md border-gray-300 shadow-sm p-1 border question-remarks-textarea"></textarea>

                        </div>

                    </div>

                    <!-- Question 3 -->

                    <div class="grid grid-cols-12 gap-2 py-2 items-center rounded-md form-row-light mb-2 p-2" data-question-id="q3">

                        <div class="col-span-6 flex items-center gap-2">

                            <span class="icon-bg-green rounded-full p-1 text-white text-xs inline-flex items-center justify-center w-6 h-6 icon-number">3</span>

                            <span class="description-text"></span>

                        </div>

                        <div class="col-span-2">

                            <select name="rating_q3" class="w-full rounded-md border-gray-300 shadow-sm p-1 text-center border question-rating-select">

                                <option value="" disabled selected>None</option>

                                <option value="Yes">Yes</option>

                                <option value="No">No</option>

                            </select>

                        </div>

                        <div class="col-span-1 text-center weight-display" data-weightage="0"></div> 

                        <div class="col-span-1 text-center">

                            <input type="number" name="points_q3" class="w-full text-center p-1 border rounded-md question-points-input" value="0" readonly placeholder="0">

                        </div>

                        <div class="col-span-2">

                            <textarea name="remarks_q3" rows="1" class="w-full rounded-md border-gray-300 shadow-sm p-1 border question-remarks-textarea"></textarea>

                        </div>

                    </div>

                    <!-- Question 4 -->

                    <div class="grid grid-cols-12 gap-2 py-2 items-center rounded-md form-row-dark mb-2 p-2" data-question-id="q4">

                        <div class="col-span-6 flex items-center gap-2">

                            <span class="icon-bg-yellow rounded-full p-1 text-white text-xs inline-flex items-center justify-center w-6 h-6 icon-number">4</span>

                            <span class="description-text"></span>

                        </div>

                        <div class="col-span-2">

                            <select name="rating_q4" class="w-full rounded-md border-gray-300 shadow-sm p-1 text-center border question-rating-select">

                                <option value="" disabled selected>None</option>

                                <option value="Yes">Yes</option>

                                <option value="No">No</option>

                            </select>

                        </div>

                        <div class="col-span-1 text-center weight-display" data-weightage="0"></div> 

                        <div class="col-span-1 text-center">

                            <input type="number" name="points_q4" class="w-full text-center p-1 border rounded-md question-points-input" value="0" readonly placeholder="0">

                        </div>

                        <div class="col-span-2">

                            <textarea name="remarks_q4" rows="1" class="w-full rounded-md border-gray-300 shadow-sm p-1 border question-remarks-textarea"></textarea>

                        </div>

                    </div>

                    <!-- Question 5 -->

                    <div class="grid grid-cols-12 gap-2 py-2 items-center rounded-md form-row-light mb-2 p-2" data-question-id="q5">

                        <div class="col-span-6 flex items-center gap-2">

                            <span class="icon-bg-orange rounded-full p-1 text-white text-xs inline-flex items-center justify-center w-6 h-6 icon-number">5</span>

                            <span class="description-text"></span>

                        </div>

                        <div class="col-span-2">

                            <select name="rating_q5" class="w-full rounded-md border-gray-300 shadow-sm p-1 text-center border question-rating-select">

                                <option value="" disabled selected>None</option>

                                <option value="Yes">Yes</option>

                                <option value="No">No</option>

                            </select>

                        </div>

                        <div class="col-span-1 text-center weight-display" data-weightage="0"></div> 

                        <div class="col-span-1 text-center">

                            <input type="number" name="points_q5" class="w-full text-center p-1 border rounded-md question-points-input" value="0" readonly placeholder="0">

                        </div>

                        <div class="col-span-2">

                            <textarea name="remarks_q5" rows="1" class="w-full rounded-md border-gray-300 shadow-sm p-1 border question-remarks-textarea"></textarea>

                        </div>

                    </div>

                </div>

            </div>



            <div class="mt-4">

                <div class="section-header-bg text-white p-3 font-semibold flex items-center gap-2">

                    <i class="fas fa-lightbulb tile-icon"></i> <!-- Font Awesome icon for Problem Solving -->

                    PROBLEM SOLVING SKILLS

                </div>

                <div class="p-4">

                    <div class="grid grid-cols-12 gap-2 text-sm font-medium text-gray-700 mb-2">

                        <div class="col-span-6">Description</div>

                        <div class="col-span-2 text-center">Rating</div>

                        <div class="col-span-1 text-center">Weight</div>

                        <div class="col-span-1 text-center">Pnts</div>

                        <div class="col-span-2">Remarks</div>

                    </div>

                    <!-- Question 6 -->

                    <div class="grid grid-cols-12 gap-2 py-2 items-center rounded-md form-row-light mb-2 p-2" data-question-id="q6">

                        <div class="col-span-6 flex items-center gap-2">

                            <span class="icon-bg-orange rounded-full p-1 text-white text-xs inline-flex items-center justify-center w-6 h-6 icon-number">6</span>

                            <span class="description-text"></span>

                        </div>

                        <div class="col-span-2">

                            <select name="rating_q6" class="w-full rounded-md border-gray-300 shadow-sm p-1 text-center border question-rating-select">

                                <option value="" disabled selected>None</option>

                                <option value="Yes">Yes</option>

                                <option value="No">No</option>

                            </select>

                        </div>

                        <div class="col-span-1 text-center weight-display" data-weightage="0"></div> 

                        <div class="col-span-1 text-center">

                            <input type="number" name="points_q6" class="w-full text-center p-1 border rounded-md question-points-input" value="0" readonly placeholder="0">

                        </div>

                        <div class="col-span-2">

                            <textarea name="remarks_q6" rows="1" class="w-full rounded-md border-gray-300 shadow-sm p-1 border question-remarks-textarea"></textarea>

                        </div>

                    </div>

                    <!-- Question 7 -->

                    <div class="grid grid-cols-12 gap-2 py-2 items-center rounded-md form-row-dark mb-2 p-2" data-question-id="q7">

                        <div class="col-span-6 flex items-center gap-2">

                            <span class="icon-bg-blue rounded-full p-1 text-white text-xs inline-flex items-center justify-center w-6 h-6 icon-number">7</span>

                            <span class="description-text"></span>

                        </div>

                        <div class="col-span-2">

                            <select name="rating_q7" class="w-full rounded-md border-gray-300 shadow-sm p-1 text-center border question-rating-select">

                                <option value="" disabled selected>None</option>

                                <option value="Yes">Yes</option>

                                <option value="No">No</option>

                            </select>

                        </div>

                        <div class="col-span-1 text-center weight-display" data-weightage="0"></div> 

                        <div class="col-span-1 text-center">

                            <input type="number" name="points_q7" class="w-full text-center p-1 border rounded-md question-points-input" value="0" readonly placeholder="0">

                        </div>

                        <div class="col-span-2">

                            <textarea name="remarks_q7" rows="1" class="w-full rounded-md border-gray-300 shadow-sm p-1 border question-remarks-textarea"></textarea>

                        </div>

                    </div>

                    <!-- Question 8 -->

                    <div class="grid grid-cols-12 gap-2 py-2 items-center rounded-md form-row-light mb-2 p-2" data-question-id="q8">

                        <div class="col-span-6 flex items-center gap-2">

                            <span class="icon-bg-green rounded-full p-1 text-white text-xs inline-flex items-center justify-center w-6 h-6 icon-number">8</span>

                            <span class="description-text"></span>

                        </div>

                        <div class="col-span-2">

                            <select name="rating_q8" class="w-full rounded-md border-gray-300 shadow-sm p-1 text-center border question-rating-select">

                                <option value="" disabled selected>None</option>

                                <option value="Yes">Yes</option>

                                <option value="No">No</option>

                            </select>

                        </div>

                        <div class="col-span-1 text-center weight-display" data-weightage="0"></div> 

                        <div class="col-span-1 text-center">

                            <input type="number" name="points_q8" class="w-full text-center p-1 border rounded-md question-points-input" value="0" readonly placeholder="0">

                        </div>

                        <div class="col-span-2">

                            <textarea name="remarks_q8" rows="1" class="w-full rounded-md border-gray-300 shadow-sm p-1 border question-remarks-textarea"></textarea>

                        </div>

                    </div>

                    <!-- Question 9 -->

                    <div class="grid grid-cols-12 gap-2 py-2 items-center rounded-md form-row-dark mb-2 p-2" data-question-id="q9">

                        <div class="col-span-6 flex items-center gap-2">

                            <span class="icon-bg-yellow rounded-full p-1 text-white text-xs inline-flex items-center justify-center w-6 h-6 icon-number">9</span>

                            <span class="description-text"></span>

                        </div>

                        <div class="col-span-2">

                            <select name="rating_q9" class="w-full rounded-md border-gray-300 shadow-sm p-1 text-center border question-rating-select">

                                <option value="" disabled selected>None</option>

                                <option value="Yes">Yes</option>

                                <option value="No">No</option>

                            </select>

                        </div>

                        <div class="col-span-1 text-center weight-display" data-weightage="0"></div> 

                        <div class="col-span-1 text-center">

                            <input type="number" name="points_q9" class="w-full text-center p-1 border rounded-md question-points-input" value="0" readonly placeholder="0">

                        </div>

                        <div class="col-span-2">

                            <textarea name="remarks_q9" rows="1" class="w-full rounded-md border-gray-300 shadow-sm p-1 border question-remarks-textarea"></textarea>

                        </div>

                    </div>

                    <!-- Question 10 -->

                    <div class="grid grid-cols-12 gap-2 py-2 items-center rounded-md form-row-light mb-2 p-2" data-question-id="q10">

                        <div class="col-span-6 flex items-center gap-2">

                            <span class="icon-bg-orange rounded-full p-1 text-white text-xs inline-flex items-center justify-center w-6 h-6 icon-number">10</span>

                            <span class="description-text"></span>

                        </div>

                        <div class="col-span-2">

                            <select name="rating_q10" class="w-full rounded-md border-gray-300 shadow-sm p-1 text-center border question-rating-select">

                                <option value="" disabled selected>None</option>

                                <option value="Yes">Yes</option>

                                <option value="No">No</option>

                            </select>

                        </div>

                        <div class="col-span-1 text-center weight-display" data-weightage="0"></div> 

                        <div class="col-span-1 text-center">

                            <input type="number" name="points_q10" class="w-full text-center p-1 border rounded-md question-points-input" value="0" readonly placeholder="0">

                        </div>

                        <div class="col-span-2">

                            <textarea name="remarks_q10" rows="1" class="w-full rounded-md border-gray-300 shadow-sm p-1 border question-remarks-textarea"></textarea>

                        </div>

                    </div>

                </div>

            </div>



            <div class="mt-4">

                <div class="section-header-bg text-white p-3 font-semibold flex items-center gap-2">

                    <i class="fas fa-check-circle tile-icon"></i> <!-- Font Awesome icon for Compliance -->

                    COMPLIANCE AND BUSINESS CRITICAL ACCURACY

                </div>

                <div class="p-4">

                    <div class="grid grid-cols-12 gap-2 text-sm font-medium text-gray-700 mb-2">

                        <div class="col-span-6">Description</div>

                        <div class="col-span-2 text-center">Rating</div>

                        <div class="col-span-1 text-center">Weight</div>

                        <div class="col-span-1 text-center">Pnts</div>

                        <div class="col-span-2">Remarks</div>

                    </div>

                    <!-- Question 11 -->

                    <div class="grid grid-cols-12 gap-2 py-2 items-center rounded-md form-row-light mb-2 p-2" data-question-id="q11">

                        <div class="col-span-6 flex items-center gap-2">

                            <span class="icon-bg-orange rounded-full p-1 text-white text-xs inline-flex items-center justify-center w-6 h-6 icon-number">11</span>

                            <span class="description-text"></span>

                        </div>

                        <div class="col-span-2">

                            <select name="rating_q11" class="w-full rounded-md border-gray-300 shadow-sm p-1 text-center border question-rating-select">

                                <option value="" disabled selected>None</option>

                                <option value="Yes">Yes</option>

                                <option value="No">No</option>

                            </select>

                        </div>

                        <div class="col-span-1 text-center weight-display" data-weightage="0"></div> 

                        <div class="col-span-1 text-center">

                            <input type="number" name="points_q11" class="w-full text-center p-1 border rounded-md question-points-input" value="0" readonly placeholder="0">

                        </div>

                        <div class="col-span-2">

                            <textarea name="remarks_q11" rows="1" class="w-full rounded-md border-gray-300 shadow-sm p-1 border question-remarks-textarea"></textarea>

                        </div>

                    </div>

                    <!-- Question 12 -->

                    <div class="grid grid-cols-12 gap-2 py-2 items-center rounded-md form-row-dark mb-2 p-2" data-question-id="q12">

                        <div class="col-span-6 flex items-center gap-2">

                            <span class="icon-bg-blue rounded-full p-1 text-white text-xs inline-flex items-center justify-center w-6 h-6 icon-number">12</span>

                            <span class="description-text"></span>

                        </div>

                        <div class="col-span-2">

                            <select name="rating_q12" class="w-full rounded-md border-gray-300 shadow-sm p-1 text-center border question-rating-select">

                                <option value="" disabled selected>None</option>

                                <option value="Yes">Yes</option>

                                <option value="No">No</option>

                            </select>

                        </div>

                        <div class="col-span-1 text-center weight-display" data-weightage="0"></div> 

                        <div class="col-span-1 text-center">

                            <input type="number" name="points_q12" class="w-full text-center p-1 border rounded-md question-points-input" value="0" readonly placeholder="0">

                        </div>

                        <div class="col-span-2">

                            <textarea name="remarks_q12" rows="1" class="w-full rounded-md border-gray-300 shadow-sm p-1 border question-remarks-textarea"></textarea>

                        </div>

                    </div>

                    <!-- Question 13 -->

                    <div class="grid grid-cols-12 gap-2 py-2 items-center rounded-md form-row-light mb-2 p-2" data-question-id="q13">

                        <div class="col-span-6 flex items-center gap-2">

                            <span class="icon-bg-green rounded-full p-1 text-white text-xs inline-flex items-center justify-center w-6 h-6 icon-number">13</span>

                            <span class="description-text"></span>

                        </div>

                        <div class="col-span-2">

                            <select name="rating_q13" class="w-full rounded-md border-gray-300 shadow-sm p-1 text-center border question-rating-select">

                                <option value="" disabled selected>None</option>

                                <option value="Yes">Yes</option>

                                <option value="No">No</option>

                            </select>

                        </div>

                        <div class="col-span-1 text-center weight-display" data-weightage="0"></div> 

                        <div class="col-span-1 text-center">

                            <input type="number" name="points_q13" class="w-full text-center p-1 border rounded-md question-points-input" value="0" readonly placeholder="0">

                        </div>

                        <div class="col-span-2">

                            <textarea name="remarks_q13" rows="1" class="w-full rounded-md border-gray-300 shadow-sm p-1 border question-remarks-textarea"></textarea>

                        </div>

                    </div>

                    <!-- Question 14 -->

                    <div class="grid grid-cols-12 gap-2 py-2 items-center rounded-md form-row-dark mb-2 p-2" data-question-id="q14">

                        <div class="col-span-6 flex items-center gap-2">

                            <span class="icon-bg-yellow rounded-full p-1 text-white text-xs inline-flex items-center justify-center w-6 h-6 icon-number">14</span>

                            <span class="description-text"></span>

                        </div>

                        <div class="col-span-2">

                            <select name="rating_q14" class="w-full rounded-md border-gray-300 shadow-sm p-1 text-center border question-rating-select">

                                <option value="" disabled selected>None</option>

                                <option value="Yes">Yes</option>

                                <option value="No">No</option>

                            </select>

                        </div>

                        <div class="col-span-1 text-center weight-display" data-weightage="0"></div> 

                        <div class="col-span-1 text-center">

                            <input type="number" name="points_q14" class="w-full text-center p-1 border rounded-md question-points-input" value="0" readonly placeholder="0">

                        </div>

                        <div class="col-span-2">

                            <textarea name="remarks_q14" rows="1" class="w-full rounded-md border-gray-300 shadow-sm p-1 border question-remarks-textarea"></textarea>

                        </div>

                    </div>

                </div>

            </div>



            <div class="p-6 flex flex-col items-end">

                <table class="score-summary-table w-full md:w-1/2 lg:w-1/3 text-right text-sm border-collapse border border-blue-500">

                    <tbody>

                        <tr class="border-b border-blue-500">

                            <td class="text-left font-medium p-2 border border-blue-500">Total Pts.</td>

                            <td class="text-right text-gray-500 p-2 border border-blue-500" id="total-pts-percentage">0%</td>

                        </tr>

                        <tr class="border-b border-blue-500">

                            <td class="text-left font-medium p-2 border border-blue-500">Available Pts.</td>

                            <td class="text-right text-gray-500 p-2 border border-blue-500" id="available-pts-display">100%</td>

                        </tr>

                        <tr>

                            <td class="text-left font-bold icealion-orange-text p-2 border border-blue-500">Overall Score</td>

                            <td class="text-right font-bold icealion-orange-text p-2 border border-blue-500" id="overall-final-percentage-display">0%</td>

                        </tr>

                    </tbody>

                </table>

                <div class="flex items-center justify-between w-full mt-4">

                    <img src="https://placehold.co/150x50/FFFFFF/1a73e8?text=ICEALION%0AGROUP" alt="ICEALION Group" class="h-12 rounded-md">

                    <div class="flex space-x-4">

                        <!-- New Submit button -->

                        <button type="button" id="submitFormBtn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-md shadow-md transition duration-300 ease-in-out">

                            Submit

                        </button>

                        <button type="button" id="print-email-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-md shadow-sm transition duration-300 ease-in-out">

                            PDF & Email

                        </button>

                        <button type="button" id="save-reset-btn" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-md shadow-md transition duration-300 ease-in-out">

                            Reset

                        </button>

                    </div>

                </div>

            </div>

        </form>

    </div>



    <script>

        document.addEventListener('DOMContentLoaded', function() {

            console.log("DOM fully loaded and parsed. Script starting.");



            // Login elements

            const loginPage = document.getElementById('loginPage');

            const loginForm = document.getElementById('loginForm');

            const usernameInput = document.getElementById('username');

            const passwordInput = document.getElementById('password');

            const loginMessage = document.getElementById('loginMessage'); 

            const mainFormContent = document.getElementById('mainFormContent'); 



            // Form buttons (main form)

            const submitFormBtn = document.getElementById('submitFormBtn'); 

            const printEmailBtn = document.getElementById('print-email-btn');

            const saveResetBtn = document.getElementById('save-reset-btn'); 

            

            // Basic Info Fields

            const contactIdInput = document.getElementById('contact-id');

            const clientNameInput = document.getElementById('client-name');

            const cerNameSelect = document.getElementById('cer-name');

            const cerRoleSelect = document.getElementById('cer-role');

            const callDateTimeInput = document.getElementById('call-date-time');

            const reviewerNameSelect = document.getElementById('reviewer-name');

            const otherReviewerNameInput = document.getElementById('other-reviewer-name'); 

            const autofailTypeSelect = document.getElementById('autofail-type');

            const evaluationDateInput = document.getElementById('review-date'); 

            const durationInput = document.getElementById('duration'); 



            // Score displays

            const overallScoreDisplay = document.getElementById('overall-score-display');

            const businessComplianceAccuracyDisplay = document.getElementById('business-compliance-accuracy');

            const totalPtsPercentageDisplay = document.getElementById('total-pts-percentage');

            const availablePtsDisplay = document.getElementById('available-pts-display'); // New element to display max possible points

            const overallFinalPercentageDisplay = document.getElementById('overall-final-percentage-display');



            // Navigation and Logout

            const mainNav = document.getElementById('mainNav'); 

            const logoutBtn = document.getElementById('logoutBtn'); 



            // --- Global Variables for Calculation ---

            let globalTotalPoints = 0;

            let globalMaxPossiblePoints = 0; 

            let globalBusinessComplianceAccuracyValue = 0; 



            // --- Define all question sets based on CER Role ---

            const ALL_QUESTION_SETS = {

                'Outbound Sales': [

                    { description: 'Did the CER provide proper branding and personalize the call?', weightage: 6, autofail: false, category: 'CUSTOMER EXPERIENCE' },

                    { description: 'Did the CER demonstrate confidence and business etiquette althroughout the call session?', weightage: 8, autofail: false, category: 'CUSTOMER EXPERIENCE' },

                    { description: 'Did the CER express a sincere acknowledgement/empathy statement when applicable?', weightage: 6, autofail: false, category: 'CUSTOMER EXPERIENCE' },

                    { description: 'Did the CER convey his/her thoughts in an understandable clear and concise manner?', weightage: 8, autofail: false, category: 'CUSTOMER EXPERIENCE' },

                    { description: 'Was the CER able to build rapport?', weightage: 8, autofail: false, category: 'CUSTOMER EXPERIENCE' },

                    { description: 'Did the CER ask effective probing questions to ensure accurate diagnosis?', weightage: 6, autofail: false, category: 'PROBLEM SOLVING SKILLS' },

                    { description: 'Was the CER\'s focus solely on the Customer?', weightage: 7, autofail: false, category: 'PROBLEM SOLVING SKILLS' },

                    { description: 'Did the CER demonstrate strong Product Knowledge?', weightage: 10, autofail: false, category: 'PROBLEM SOLVING SKILLS' },

                    { description: 'Did the CER document all action items & follow-up? (Autofail)', weightage: 6, autofail: true, category: 'PROBLEM SOLVING SKILLS' },

                    { description: 'Was the CER able to sell to the customer?', weightage: 10, autofail: false, category: 'PROBLEM SOLVING SKILLS' },

                    { description: 'Did the CER log call information correctly? (Data capture)', weightage: 10, autofail: true, category: 'COMPLIANCE AND BUSINESS CRITICAL ACCURACY' },

                    { description: 'Did the CER adhere to Company Policies & Procedures?(Autofail)', weightage: 5, autofail: true, category: 'COMPLIANCE AND BUSINESS CRITICAL ACCURACY' },

                    { description: 'Did the CER Comply with industry and legal requirements?', weightage: 5, autofail: false, category: 'COMPLIANCE AND BUSINESS CRITICAL ACCURACY' },

                    { description: 'Was the CER able to identify and opportunity for Upselling & Cross-Selling?', weightage: 5, autofail: false, category: 'COMPLIANCE AND BUSINESS CRITICAL ACCURACY' }

                ],

                'Onboarding outbound': [

                    { description: 'Did the CER provide proper branding and personalize the call?', weightage: 6, autofail: false, category: 'CUSTOMER EXPERIENCE' },

                    { description: 'Did the CER demonstrate confidence and business etiquette althroughout the call session?', weightage: 7, autofail: false, category: 'CUSTOMER EXPERIENCE' },

                    { description: 'Did the CER express a sincere acknowledgement/empathy statement when applicable?', weightage: 6, autofail: false, category: 'CUSTOMER EXPERIENCE' },

                    { description: 'Did the CER convey his/her thoughts in an understandable clear and concise manner?', weightage: 6, autofail: false, category: 'CUSTOMER EXPERIENCE' },

                    { description: 'Was the CER able to build rapport?', weightage: 8, autofail: false, category: 'CUSTOMER EXPERIENCE' },

                    { description: 'Did the CER ask effective probing questions to ensure accurate diagnosis?', weightage: 5, autofail: false, category: 'PROBLEM SOLVING SKILLS' },

                    { description: 'Did the CER do proper research and check all related tools required?', weightage: 7, autofail: false, category: 'PROBLEM SOLVING SKILLS' },

                    { description: 'Did the CER demonstrate strong Product and Process Knowledge?', weightage: 10, autofail: false, category: 'PROBLEM SOLVING SKILLS' },

                    { description: 'Was the CER able to meet the call objective? (FCR)', weightage: 10, autofail: false, category: 'PROBLEM SOLVING SKILLS' },

                    { description: 'Did the CER document all action items & follow-up?', weightage: 8, autofail: false, category: 'PROBLEM SOLVING SKILLS' },

                    { description: 'Did the CER log call information correctly?', weightage: 10, autofail: false, category: 'COMPLIANCE AND BUSINESS CRITICAL ACCURACY' },

                    { description: 'Did the CER adhere to Company Policies & Procedures?', weightage: 5, autofail: false, category: 'COMPLIANCE AND BUSINESS CRITICAL ACCURACY' },

                    { description: 'Did the CER Comply with industry and legal requirements?', weightage: 5, autofail: false, category: 'COMPLIANCE AND BUSINESS CRITICAL ACCURACY' },

                    { description: 'Was the CER able to identify and opportunity for Upselling & Cross-Selling?', weightage: 7, autofail: false, category: 'COMPLIANCE AND BUSINESS CRITICAL ACCURACY' }

                ],

                'Social Media': [

                    { description: 'Did the CER provide proper branding and personalize the Interaction?', weightage: 5, autofail: false, category: 'CUSTOMER EXPERIENCE' },

                    { description: 'Did the CER demonstrate confidence and business etiquette althroughout the interaction session?', weightage: 6, autofail: false, category: 'CUSTOMER EXPERIENCE' },

                    { description: 'Did the CER express a sincere acknowledgement/empathy statement when applicable?', weightage: 7, autofail: false, category: 'CUSTOMER EXPERIENCE' },

                    { description: 'Did the CER convey his/her thoughts in an understandable clear and concise manner?', weightage: 7, autofail: false, category: 'CUSTOMER EXPERIENCE' },

                    { description: 'Did the CER keep the customer informed?(TAT, dead air)', weightage: 5, autofail: false, category: 'CUSTOMER EXPERIENCE' },

                    { description: 'Did the CER ask effective probing questions to ensure accurate diagnosis?', weightage: 9, autofail: false, category: 'PROBLEM SOLVING SKILLS' },

                    { description: 'Did the CER do proper research and check all related tools required?(Due diligence)', weightage: 7, autofail: false, category: 'PROBLEM SOLVING SKILLS' },

                    { description: 'Did the CER show ownership and respond within the set turnaround time? (10 mins)', weightage: 6, autofail: false, category: 'PROBLEM SOLVING SKILLS' },

                    { description: 'Was the CER able to position all possible options to the customer?(FCR)', weightage: 13, autofail: false, category: 'PROBLEM SOLVING SKILLS' },

                    { description: 'Did the CER avoid risk behavior? (interaction avoidance/ZTP)', weightage: 8, autofail: false, category: 'PROBLEM SOLVING SKILLS' },

                    { description: 'Did the CER log ticket information correctly?(Data capture)', weightage: 6, autofail: false, category: 'COMPLIANCE AND BUSINESS CRITICAL ACCURACY' },

                    { description: 'Did the CER properly authenticate the customer?(KYC)', weightage: 8, autofail: false, category: 'COMPLIANCE AND BUSINESS CRITICAL ACCURACY' },

                    { description: 'Did the CER provide complete and accurate information?(Customer education)', weightage: 10, autofail: false, category: 'COMPLIANCE AND BUSINESS CRITICAL ACCURACY' },

                    { description: 'Did the CER identify an opportunity to upsell/cross sell a product?', weightage: 5, autofail: false, category: 'COMPLIANCE AND BUSINESS CRITICAL ACCURACY' }

                ],

                'Live Chat': [

                    { description: 'Did the CER provide proper branding and personalize the conversation?', weightage: 5, autofail: false, category: 'CUSTOMER EXPERIENCE' },

                    { description: 'Did the CER demonstrate confidence and business etiquette althroughout the conversation session?', weightage: 7, autofail: false, category: 'CUSTOMER EXPERIENCE' },

                    { description: 'Did the CER express a sincere acknowledgement/empathy statement when applicable?', weightage: 7, autofail: false, category: 'CUSTOMER EXPERIENCE' },

                    { description: 'Did the CER convey his/her thoughts in an understandable clear and concise manner?', weightage: 6, autofail: false, category: 'CUSTOMER EXPERIENCE' },

                    { description: 'Did the CER keep the customer informed?(Dead Air-Average Response Time 1 min, TAT, )', weightage: 5, autofail: false, category: 'CUSTOMER EXPERIENCE' },

                    { description: 'Did the CER ask effective probing questions to ensure accurate diagnosis?', weightage: 9, autofail: false, category: 'PROBLEM SOLVING SKILLS' },

                    { description: 'Did the CER do proper research and check all related tools required?', weightage: 7, autofail: false, category: 'PROBLEM SOLVING SKILLS' },

                    { description: 'Did the CER show ownership and respond within the set turnaround time? (10 Secs)', weightage: 6, autofail: false, category: 'PROBLEM SOLVING SKILLS' },

                    { description: 'Was the CER able to position all possible options to the customer?(FCR)', weightage: 13, autofail: false, category: 'PROBLEM SOLVING SKILLS' },

                    { description: 'Did the CER avoid risk behavior? (conversation avoidance/ZTP)', weightage: 8, autofail: false, category: 'PROBLEM SOLVING SKILLS' },

                    { description: 'Did the CER log ticket information correctly?(Data Capture)', weightage: 6, autofail: false, category: 'COMPLIANCE AND BUSINESS CRITICAL ACCURACY' },

                    { description: 'Did the CER properly authenticate the customer?(KYC)', weightage: 8, autofail: false, category: 'COMPLIANCE AND BUSINESS CRITICAL ACCURACY' },

                    { description: 'Did the CER provide complete and accurate information?(Customer education)', weightage: 9, autofail: false, category: 'COMPLIANCE AND BUSINESS CRITICAL ACCURACY' },

                    { description: 'Did the CER identify an opportunity to upsell/cross sell a product?', weightage: 5, autofail: false, category: 'COMPLIANCE AND BUSINESS CRITICAL ACCURACY' }

                ],

                'Inbound': [

                    { description: 'Did the CER provide proper branding and personalize the call?', weightage: 6, autofail: false, category: 'CUSTOMER EXPERIENCE' },

                    { description: 'Did the CER demonstrate confidence and business etiquette althroughout the call session?', weightage: 6, autofail: false, category: 'CUSTOMER EXPERIENCE' },

                    { description: 'Did the CER express a sincere acknowledgement/empathy statement when applicable?', weightage: 8, autofail: false, category: 'CUSTOMER EXPERIENCE' },

                    { description: 'Did the CER convey his/her thoughts in an understandable clear and concise manner?', weightage: 4, autofail: false, category: 'CUSTOMER EXPERIENCE' },

                    { description: 'Did the CER keep the caller informed?(Dead air/Hold/TAT)', weightage: 6, autofail: false, category: 'CUSTOMER EXPERIENCE' },

                    { description: 'Did the CER ask effective probing questions to ensure accurate diagnosis?', weightage: 6, autofail: false, category: 'PROBLEM SOLVING SKILLS' },

                    { description: 'Did the CER do proper research and check all related tools required? (fact finding)', weightage: 7, autofail: false, category: 'PROBLEM SOLVING SKILLS' },

                    { description: 'Did the CER show ownership and actively listen?', weightage: 9, autofail: false, category: 'PROBLEM SOLVING SKILLS' },

                    { description: 'Was the CER able to position all possible options to the customer?(FCR)', weightage: 10, autofail: false, category: 'PROBLEM SOLVING SKILLS' },

                    { description: 'Did the CER avoid risk behavior? (Call avoidance/ZTP)', weightage: 7, autofail: false, category: 'PROBLEM SOLVING SKILLS' },

                    { description: 'Did the CER log call information correctly?(Data capture)', weightage: 10, autofail: true, category: 'COMPLIANCE AND BUSINESS CRITICAL ACCURACY' },

                    { description: 'Did the CER properly authenticate the caller?(KYC)', weightage: 6, autofail: true, category: 'COMPLIANCE AND BUSINESS CRITICAL ACCURACY' },

                    { description: 'Did the CER provide complete and accurate information? (Customer education)', weightage: 9, autofail: false, category: 'COMPLIANCE AND BUSINESS CRITICAL ACCURACY' },

                    { description: 'Did the CER identify an opportunity to upsell/cross sell a product?', weightage: 5, autofail: false, category: 'COMPLIANCE AND BUSINESS CRITICAL ACCURACY' }

                ],

                'Email': [

                    { description: 'Did the CER provide proper branding and personalize the email?', weightage: 5, autofail: false, category: 'CUSTOMER EXPERIENCE' },

                    { description: 'Did the CER demonstrate confidence and business etiquette althroughout the interaction?', weightage: 7, autofail: false, category: 'CUSTOMER EXPERIENCE' },

                    { description: 'Did the CER express a sincere acknowledgement/empathy statement when applicable?', weightage: 7, autofail: false, category: 'CUSTOMER EXPERIENCE' },

                    { description: 'Did the CER convey his/her thoughts in an understandable clear and concise manner?', weightage: 6, autofail: false, category: 'CUSTOMER EXPERIENCE' },

                    { description: 'Did the CER keep the customer informed?', weightage: 5, autofail: false, category: 'CUSTOMER EXPERIENCE' },

                    { description: 'Did the CER call to ask effective probing questions to ensure accurate diagnosis?', weightage: 9, autofail: false, category: 'PROBLEM SOLVING SKILLS' },

                    { description: 'Did the CER do proper research and check all related tools required?', weightage: 7, autofail: false, category: 'PROBLEM SOLVING SKILLS' },

                    { description: 'Did the CER show ownership and respond within the set turnaround time?(8 hours)', weightage: 6, autofail: false, category: 'PROBLEM SOLVING SKILLS' },

                    { description: 'Was the CER able to position all possible options to the customer?', weightage: 13, autofail: false, category: 'PROBLEM SOLVING SKILLS' },

                    { description: 'Did the CER avoid risk behavior? (Call avoidance/ZTP)', weightage: 8, autofail: false, category: 'PROBLEM SOLVING SKILLS' },

                    { description: 'Did the CER log ticket information correctly?', weightage: 6, autofail: false, category: 'COMPLIANCE AND BUSINESS CRITICAL ACCURACY' },

                    { description: 'Did the CER properly authenticate the writer?', weightage: 8, autofail: false, category: 'COMPLIANCE AND BUSINESS CRITICAL ACCURACY' },

                    { description: 'Did the CER provide complete and accurate information?(Customer education)', weightage: 9, autofail: false, category: 'COMPLIANCE AND BUSINESS CRITICAL ACCURACY' },

                    { description: 'Did the CER identify an opportunity to upsell/cross sell a product?', weightage: 5, autofail: false, category: 'COMPLIANCE AND BUSINESS CRITICAL ACCURACY' }

                ],

                'Digital troubleshooting': [

                    { description: 'Did the Agent provide proper branding and personalize the call?', weightage: 6, autofail: false, category: 'CUSTOMER EXPERIENCE' },

                    { description: 'Did the Agent demonstrate confidence and business etiquette althroughout the call session?', weightage: 6, autofail: false, category: 'CUSTOMER EXPERIENCE' },

                    { description: 'Did the Agent express a sincere acknowledgement/empathy statement when applicable?', weightage: 7, autofail: false, category: 'CUSTOMER EXPERIENCE' },

                    { description: 'Did the Agent convey his/her thoughts in an understandable clear and concise manner?', weightage: 7, autofail: false, category: 'CUSTOMER EXPERIENCE' },

                    { description: 'Did the Agent keep the caller informed?', weightage: 5, autofail: false, category: 'CUSTOMER EXPERIENCE' },

                    { description: 'Did the Agent ask effective probing questions to ensure accurate diagnosis?', weightage: 5.5, autofail: false, category: 'PROBLEM SOLVING SKILLS' },

                    { description: 'Did the Agent do proper research and check all related tools required?', weightage: 11, autofail: false, category: 'PROBLEM SOLVING SKILLS' },

                    { description: 'Did the Agent show ownership and actively listen?', weightage: 6, autofail: false, category: 'PROBLEM SOLVING SKILLS' },

                    { description: 'Was the Agent able to position all possible options to the customer?', weightage: 10.5, autofail: false, category: 'PROBLEM SOLVING SKILLS' },

                    { description: 'Did the agent avoid risk behavior? (Call avoidance/ZTP)', weightage: 7, autofail: false, category: 'PROBLEM SOLVING SKILLS' },

                    { description: 'Did the Agent log call information correctly?', weightage: 7, autofail: false, category: 'COMPLIANCE AND BUSINESS CRITICAL ACCURACY' },

                    { description: 'Did the Agent properly authenticate the caller?', weightage: 8, autofail: false, category: 'COMPLIANCE AND BUSINESS CRITICAL ACCURACY' },

                    { description: 'Did the Agent provide complete and accurate information?', weightage: 9, autofail: false, category: 'COMPLIANCE AND BUSINESS CRITICAL ACCURACY' },

                    { description: 'Did the Agent identify an opportunity to upsell/cross sell a product?', weightage: 5, autofail: false, category: 'COMPLIANCE AND BUSINESS CRITICAL ACCURACY' }

                ],

                'SMS': [

                    { description: 'Did the CER provide proper branding and personalize the conversation?', weightage: 5, autofail: false, category: 'CUSTOMER EXPERIENCE' },

                    { description: 'Did the CER demonstrate confidence and business etiquette all throughout the conversation session?', weightage: 7, autofail: false, category: 'CUSTOMER EXPERIENCE' },

                    { description: 'Did the CER express a sincere acknowledgement/empathy statement when applicable?', weightage: 7, autofail: false, category: 'CUSTOMER EXPERIENCE' },

                    { description: 'Did the CER convey his/her thoughts in an understandable clear and concise manner?', weightage: 6, autofail: false, category: 'CUSTOMER EXPERIENCE' },

                    { description: 'Did the CER keep the customer informed?(Dead air, TAT)', weightage: 5, autofail: false, category: 'CUSTOMER EXPERIENCE' },

                    { description: 'Did the CER ask effective probing questions to ensure accurate diagnosis?', weightage: 9, autofail: false, category: 'PROBLEM SOLVING SKILLS' },

                    { description: 'Did the CER do proper research and check all related tools required?(fact finding)', weightage: 7, autofail: false, category: 'PROBLEM SOLVING SKILLS' },

                    { description: 'Did the CER show ownership and respond within the set turnaround time?(5 mins)', weightage: 6, autofail: false, category: 'PROBLEM SOLVING SKILLS' },

                    { description: 'Was the CER able to position all possible options to the customer?(FCR)', weightage: 13, autofail: false, category: 'PROBLEM SOLVING SKILLS' },

                    { description: 'Did the CER avoid risk behavior? (conversation avoidance/ZTP)', weightage: 8, autofail: false, category: 'PROBLEM SOLVING SKILLS' },

                    { description: 'Did the CER log ticket information correctly?(Data capture)', weightage: 6, autofail: false, category: 'COMPLIANCE AND BUSINESS CRITICAL ACCURACY' },

                    { description: 'Did the CER properly authenticate the customer?(KYC)', weightage: 8, autofail: false, category: 'COMPLIANCE AND BUSINESS CRITICAL ACCURACY' },

                    { description: 'Did the CER provide complete and accurate information? (Customer education)', weightage: 9, autofail: false, category: 'COMPLIANCE AND BUSINESS CRITICAL ACCURACY' },

                    { description: 'Did the CER identify an opportunity to upsell/cross sell a product?', weightage: 5, autofail: false, category: 'COMPLIANCE AND BUSINESS CRITICAL ACCURACY' }

                ],

                'NPS outbound': [

                    { description: 'Did the Agent provide proper branding and personalize the call?', weightage: 6, autofail: false, category: 'CUSTOMER EXPERIENCE' },

                    { description: 'Did the Agent demonstrate confidence and business etiquette althroughout the call session?', weightage: 6, autofail: false, category: 'CUSTOMER EXPERIENCE' },

                    { description: 'Did the Agent express a sincere acknowledgement/empathy statement when applicable?', weightage: 7, autofail: false, category: 'CUSTOMER EXPERIENCE' },

                    { description: 'Did the Agent convey his/her thoughts in an understandable clear and concise manner?', weightage: 7, autofail: false, category: 'CUSTOMER EXPERIENCE' },

                    { description: 'Did the Agent keep the caller informed?', weightage: 5, autofail: false, category: 'CUSTOMER EXPERIENCE' },

                    { description: 'Did the Agent ask effective probing questions to ensure accurate diagnosis?', weightage: 8, autofail: false, category: 'PROBLEM SOLVING SKILLS' },

                    { description: 'Did the Agent do proper research and check all related tools required?', weightage: 7, autofail: false, category: 'PROBLEM SOLVING SKILLS' },

                    { description: 'Did the Agent show ownership and actively listen?', weightage: 6, autofail: false, category: 'PROBLEM SOLVING SKILLS' },

                    { description: 'Was the Agent able to position all possible options to the customer? Create a ticket where necessary', weightage: 11, autofail: false, category: 'PROBLEM SOLVING SKILLS' },

                    { description: 'Did the agent avoid risk behavior? (Call avoidance/ZTP)', weightage: 7, autofail: false, category: 'PROBLEM SOLVING SKILLS' },

                    { description: 'Did the Agent log call information correctly?', weightage: 7, autofail: false, category: 'COMPLIANCE AND BUSINESS CRITICAL ACCURACY' },

                    { description: 'Did the Agent confirm the feedback from the customer and put it verbatim on the survey form?', weightage: 10, autofail: false, category: 'COMPLIANCE AND BUSINESS CRITICAL ACCURACY' },

                    { description: 'Did the Agent provide complete and accurate information?', weightage: 9, autofail: false, category: 'COMPLIANCE AND BUSINESS CRITICAL ACCURACY' },

                    { description: 'Did the Agent identify an opportunity to upsell/cross sell a product?', weightage: 5, autofail: false, category: 'COMPLIANCE AND BUSINESS CRITICAL ACCURACY' }

                ],

                // Default or fallback questions (can be same as Outbound Sales if no specific role chosen)

                'Reviewed case handling': [

                     { description: 'Did the CER provide proper branding and personalize the call?', weightage: 6, autofail: false, category: 'CUSTOMER EXPERIENCE' },

                    { description: 'Did the CER demonstrate confidence and business etiquette althroughout the call session?', weightage: 6, autofail: false, category: 'CUSTOMER EXPERIENCE' },

                    { description: 'Did the CER express a sincere acknowledgement/empathy statement when applicable?', weightage: 7, autofail: false, category: 'CUSTOMER EXPERIENCE' },

                    { description: 'Did the CER convey his/her thoughts in an understandable clear and concise manner?', weightage: 7, autofail: false, category: 'CUSTOMER EXPERIENCE' },

                    { description: 'Was the CER able to build rapport?', weightage: 6, autofail: false, category: 'CUSTOMER EXPERIENCE' },

                    { description: 'Did the CER ask effective probing questions to ensure accurate diagnosis?', weightage: 8, autofail: false, category: 'PROBLEM SOLVING SKILLS' },

                    { description: 'Did the CER do proper research and check all related tools required?', weightage: 7, autofail: false, category: 'PROBLEM SOLVING SKILLS' },

                    { description: 'Did the CER show ownership and actively listen?', weightage: 8, autofail: false, category: 'PROBLEM SOLVING SKILLS' },

                    { description: 'Did the CER document all action items & follow-up? (Autofail)', weightage: 10, autofail: true, category: 'PROBLEM SOLVING SKILLS' },

                    { description: 'Was the CER able to sell to the customer?', weightage: 7, autofail: false, category: 'PROBLEM SOLVING SKILLS' },

                    { description: 'Capture precise details of the resolution', weightage: 8, autofail: false, category: 'PROBLEM SOLVING SKILLS' },

                    { description: 'Did the CER log call information correctly? (Data capture)', weightage: 7, autofail: true, category: 'COMPLIANCE AND BUSINESS CRITICAL ACCURACY' },

                    { description: 'Did the CER adhere to Company Policies & Procedures?(Autofail)', weightage: 10, autofail: true, category: 'COMPLIANCE AND BUSINESS CRITICAL ACCURACY' },

                    { description: 'Did the CER Comply with industry and legal requirements?', weightage: 9, autofail: false, category: 'COMPLIANCE AND BUSINESS CRITICAL ACCURACY' }

                    // Removed the 15th question from the original set to match the 14-question structure.

                ]

            };



            // Map of generic question IDs (q1-q14) to their HTML elements

            const questionElements = [];

            for (let i = 1; i <= 14; i++) {

                const row = document.querySelector(`[data-question-id="q${i}"]`);

                if (row) {

                    questionElements.push({

                        id: `q${i}`,

                        descriptionTextElement: row.querySelector('.description-text'),

                        weightDisplayElement: row.querySelector('.weight-display'),

                        ratingSelectElement: row.querySelector(`.question-rating-select`),

                        pointsInputElement: row.querySelector(`.question-points-input`),

                        remarksTextareaElement: row.querySelector(`.question-remarks-textarea`)

                    });

                } else {

                    console.warn(`Question row q${i} not found. Skipping.`);

                }

            }



            // --- Calculate Score Function ---

            const calculateScore = () => {

                console.log("calculateScore called.");

                globalTotalPoints = 0; 

                globalMaxPossiblePoints = 0; 

                let autofailTriggered = false;



                let complianceCurrentPoints = 0;

                let complianceMaxPoints = 0;



                questionElements.forEach((item, index) => {

                    const ratingSelect = item.ratingSelectElement;

                    const pointsInput = item.pointsInputElement;

                    const weightage = parseFloat(item.weightDisplayElement.dataset.weightage); // Get current weight from DOM

                    const isAutofailQuestion = ratingSelect.hasAttribute('data-autofail-question');

                    const questionCategory = ALL_QUESTION_SETS[cerRoleSelect.value || 'Reviewed case handling'][index].category;





                    if (!ratingSelect || !pointsInput || isNaN(weightage)) {

                        console.warn(`Skipping calculation for missing/invalid element: q${index + 1}`);

                        return;

                    }



                    const rating = ratingSelect.value;

                    let currentPoints = 0;



                    // Reset background color before applying new logic

                    pointsInput.style.backgroundColor = '#e9ecef'; // Default readonly background

                    pointsInput.style.color = '#555'; // Default text color





                    if (rating === 'Yes') {

                        currentPoints = weightage;

                        pointsInput.readOnly = false; // Make it editable again

                        pointsInput.style.backgroundColor = '#fff'; // White for editable

                    } else if (rating === 'No') {

                        currentPoints = 0;

                        pointsInput.readOnly = true; 

                        

                        // Apply red background for specific autofail questions when 'No'

                        if (isAutofailQuestion) { 

                            pointsInput.style.backgroundColor = '#fca5a5'; // Red background (tailwind red-300)

                            pointsInput.style.color = '#dc2626'; // Darker red text (tailwind red-700)

                            autofailTriggered = true; // Trigger autofail if any 'No' on an autofail question

                        } else {

                            pointsInput.style.backgroundColor = '#e0e0e0'; // Grey out background for non-autofail 'No'

                        }

                    } else { // Handle 'None' or empty selection

                        currentPoints = 0;

                        pointsInput.readOnly = true;

                        pointsInput.style.backgroundColor = '#e9ecef'; // Default readonly background

                    }



                    pointsInput.value = currentPoints; // Update individual points input



                    globalTotalPoints += currentPoints;

                    globalMaxPossiblePoints += weightage; // Sum all possible weightages





                    // Calculate Business & Compliance Accuracy (only for questions in this category)

                    if (questionCategory === 'COMPLIANCE AND BUSINESS CRITICAL ACCURACY') {

                        if (rating === 'Yes') {

                            complianceCurrentPoints += weightage;

                        }

                        // Only add to complianceMaxPoints if the question was answered (Yes or No)

                        if (rating === 'Yes' || rating === 'No') {

                            complianceMaxPoints += weightage;

                        }

                    }

                });



                let overallPercentage = 0;

                if (autofailTriggered) {

                    overallPercentage = 0;

                } else {

                    if (globalMaxPossiblePoints > 0) {

                        overallPercentage = ((globalTotalPoints / globalMaxPossiblePoints) * 100).toFixed(0);

                    } else {

                        overallPercentage = 0;

                    }

                }



                // Update the main overall score display at the top

                overallScoreDisplay.textContent = `${overallPercentage}%`;



                // Update footer percentage displays

                totalPtsPercentageDisplay.textContent = `${overallPercentage}%`; 

                availablePtsDisplay.textContent = `${globalMaxPossiblePoints}%`; // Display calculated max possible points

                overallFinalPercentageDisplay.textContent = `${overallPercentage}%`; 



                let businessCompliancePct = 0;

                if (complianceMaxPoints > 0) {

                    businessCompliancePct = ((complianceCurrentPoints / complianceMaxPoints) * 100).toFixed(0);

                } else {

                    businessCompliancePct = 0;

                }

                businessComplianceAccuracyDisplay.textContent = `${businessCompliancePct}%`;



                globalBusinessComplianceAccuracyValue = businessCompliancePct;

            };



            // --- Function to update form questions based on selected role ---

            const updateFormQuestions = (role) => {

                const questionsForRole = ALL_QUESTION_SETS[role] || ALL_QUESTION_SETS['Reviewed case handling']; // Fallback to default

                

                questionElements.forEach((elements, index) => {

                    const questionData = questionsForRole[index];



                    if (questionData) {

                        // Update description

                        elements.descriptionTextElement.textContent = questionData.description;



                        // Update weightage

                        elements.weightDisplayElement.textContent = questionData.weightage;

                        elements.weightDisplayElement.dataset.weightage = questionData.weightage;



                        // Reset rating and points

                        elements.ratingSelectElement.value = ''; // Set to disabled selected "None"

                        elements.pointsInputElement.value = 0;

                        elements.pointsInputElement.readOnly = true;

                        elements.pointsInputElement.style.backgroundColor = '#e9ecef';

                        elements.pointsInputElement.style.color = '#555';



                        // Reset remarks

                        elements.remarksTextareaElement.value = '';



                        // Set autofail attribute on select element

                        if (questionData.autofail) {

                            elements.ratingSelectElement.setAttribute('data-autofail-question', 'true');

                        } else {

                            elements.ratingSelectElement.removeAttribute('data-autofail-question');

                        }

                        // Ensure the "None" option is selected and enabled initially

                        elements.ratingSelectElement.querySelector('option[value=""]').selected = true;

                        elements.ratingSelectElement.querySelector('option[value=""]').disabled = false;



                        // Ensure other options are not disabled

                        Array.from(elements.ratingSelectElement.options).forEach(option => {

                            if (option.value !== "") {

                                option.disabled = false;

                            }

                        });





                    } else {

                        // Hide any excess questions if a role has fewer than 14

                        elements.descriptionTextElement.textContent = '';

                        elements.weightDisplayElement.textContent = '';

                        elements.weightDisplayElement.dataset.weightage = '0';

                        elements.ratingSelectElement.value = '';

                        elements.pointsInputElement.value = 0;

                        elements.remarksTextareaElement.value = '';

                        elements.ratingSelectElement.removeAttribute('data-autofail-question');

                        // Optionally hide the entire row: elements.rowElement.style.display = 'none';

                    }

                });

                calculateScore(); // Recalculate scores after updating questions

            };



            // --- Initialize Form Scores and Event Listeners ---

            function initializeForm() {

                console.log("initializeForm called.");

                // Add event listeners to all question rating selects

                questionElements.forEach(item => {

                    item.ratingSelectElement.addEventListener('change', calculateScore);

                });



                // Initial load of questions (e.g., for default 'Reviewed case handling' or whatever is initially selected)

                updateFormQuestions(cerRoleSelect.value || 'Reviewed case handling');

                

                // Set default date to today

                evaluationDateInput.valueAsDate = new Date();

                // Set default call date and time to now

                const now = new Date();

                now.setMinutes(now.getMinutes() - now.getTimezoneOffset());

                callDateTimeInput.value = now.toISOString().slice(0,16);



                // Make PDF & Email and Submit/Reset buttons visible by default

                printEmailBtn.classList.remove('hidden');

                if (submitFormBtn) submitFormBtn.classList.remove('hidden'); 

                if (saveResetBtn) saveResetBtn.classList.remove('hidden'); 

                console.log("Buttons should be visible.");

            }





            // --- Login Logic ---

            const CORRECT_USERNAME = 'Supervisor';

            const CORRECT_PASSWORD = 'Supervisor';



            const showLoginErrorMessage = (message) => {

                loginMessage.textContent = message;

                loginMessage.classList.remove('hidden');

            };



            const hideLoginErrorMessage = () => {

                loginMessage.classList.add('hidden');

                loginMessage.textContent = '';

            };



            // Check for login state on page load

            const isLoggedIn = sessionStorage.getItem('loggedIn');



            if (isLoggedIn === 'true') {

                loginPage.style.display = 'none'; 

                mainFormContent.style.display = 'block'; 

                mainNav.style.display = 'flex'; 

                initializeForm(); 

            } else {

                loginPage.style.display = 'flex'; 

                mainFormContent.style.display = 'none'; 

                mainNav.style.display = 'none'; 

            }





            loginForm.addEventListener('submit', function(event) {

                event.preventDefault();

                hideLoginErrorMessage();



                const enteredUsername = usernameInput.value;

                const enteredPassword = passwordInput.value;



                if (enteredUsername === CORRECT_USERNAME && enteredPassword === CORRECT_PASSWORD) {

                    sessionStorage.setItem('loggedIn', 'true');

                    loginPage.style.display = 'none';

                    mainFormContent.style.display = 'block';

                    mainNav.style.display = 'flex';

                    initializeForm();

                } else {

                    showLoginErrorMessage('Invalid username or password.');

                }

            });



            // Logout functionality

            if (logoutBtn) {

                logoutBtn.addEventListener('click', function() {

                    sessionStorage.removeItem('loggedIn');

                    window.location.href = 'index.html'; 

                });

            }



            // Toggle 'Other' reviewer name input

            reviewerNameSelect.addEventListener('change', () => {

                if (reviewerNameSelect.value === 'Other') {

                    otherReviewerNameInput.classList.remove('hidden');

                    otherReviewerNameInput.setAttribute('required', 'required');

                    document.getElementById('reviewer-name-error').classList.add('hidden'); // Hide specific error if 'Other' is chosen

                } else {

                    otherReviewerNameInput.classList.add('hidden');

                    otherReviewerNameInput.value = '';

                    otherReviewerNameInput.removeAttribute('required');

                    otherReviewerNameInput.style.borderColor = '';

                }

            });



            // Event listener for CER Role change

            cerRoleSelect.addEventListener('change', (event) => {

                console.log("CER Role changed to:", event.target.value);

                updateFormQuestions(event.target.value);

            });





            // Handle Reset button click (now only resets fields)

            if (saveResetBtn) { 

                saveResetBtn.addEventListener('click', function(event) {

                    event.preventDefault(); 

                    console.log("Reset button clicked - resetting form.");

                    resetForm();

                });

            }





            // Handle Submit button functionality

            const assessmentForm = document.getElementById('assessment-form'); 

            if (submitFormBtn) { 

                submitFormBtn.addEventListener('click', async function(event) {

                    event.preventDefault(); 

                    console.log("Submit button clicked - attempting form submission.");



                    // Basic client-side validation for required fields

                    const requiredInputs = document.querySelectorAll('#mainFormContent [required]:not(.hidden)'); // Target within main form content

                    let allRequiredFilled = true;

                    let firstInvalidInput = null;



                    // Clear previous error messages and borders

                    document.querySelectorAll('.text-red-500').forEach(el => el.classList.add('hidden'));

                    document.querySelectorAll('[required]').forEach(input => input.style.borderColor = '');



                    for (const input of requiredInputs) {

                        if (input.value.trim() === '' || (input.tagName === 'SELECT' && input.value === '')) {

                            allRequiredFilled = false;

                            input.style.borderColor = 'red';

                            const errorElement = document.getElementById(`${input.id}-error`);

                            if (errorElement) {

                                errorElement.classList.remove('hidden');

                            }

                            if (!firstInvalidInput) {

                                firstInvalidInput = input;

                            }

                        }

                    }

                    

                    if (!allRequiredFilled) {

                        if (firstInvalidInput) {

                            firstInvalidInput.scrollIntoView({ behavior: 'smooth', block: 'center' });

                            firstInvalidInput.focus();

                        }

                        alert('Please fill out all highlighted required fields.'); 

                        return;

                    }

                    

                    // Collect data for submission

                    const formDataForSubmission = {

                        action: 'submitForm', 

                        "CER Name": cerNameSelect.value, 

                        "Reviewer's Name:": reviewerNameSelect.value === 'Other' ? otherReviewerNameInput.value : reviewerNameSelect.value,

                        "Contact ID:": contactIdInput.value,

                        "Client Name": clientNameInput.value,

                        "Call Date and Time:": callDateTimeInput.value,

                        "CER Roles": cerRoleSelect.value,

                        "Evaluation Date:": evaluationDateInput.value,

                        "Duration:": durationInput.value,

                        "Autofail Type:": autofailTypeSelect.value,

                    };



                    // Dynamically add question data

                    questionElements.forEach((item, index) => {

                        const questionData = ALL_QUESTION_SETS[cerRoleSelect.value || 'Reviewed case handling'][index];

                        if (questionData) {

                            formDataForSubmission[questionData.description] = item.ratingSelectElement.value;

                            formDataForSubmission[`${questionData.description} - Remarks`] = item.remarksTextareaElement.value;

                            formDataForSubmission[`${questionData.description} - Points`] = item.pointsInputElement.value;

                            formDataForSubmission[`${questionData.description} - Weightage`] = questionData.weightage; // Add weightage for each question

                        }

                    });

                    

                    formDataForSubmission["Business & Compliance Accuracy"] = businessComplianceAccuracyDisplay.textContent; 

                    formDataForSubmission["Overall Score"] = overallScoreDisplay.textContent; 

                    formDataForSubmission["Total Pts."] = globalTotalPoints; 

                    formDataForSubmission["Available Pts."] = globalMaxPossiblePoints; 

                    formDataForSubmission["Final Score"] = overallFinalPercentageDisplay.textContent; 

                    

                    console.log("Collected Data for Submission:", formDataForSubmission);



                    // THIS IS THE CORRECTED URL FOR THE APPS SCRIPT WEB APP

                    const GOOGLE_APPS_SCRIPT_WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbzyoP_9ToCETeFW1tox8UfuLlv7rXTN1liwV_MxahnMhBxDGr8wnsUpBfax2Gpj6UuoEQ/exec';



                    try {

                        submitFormBtn.textContent = 'Submitting...';

                        submitFormBtn.disabled = true;

                        if (saveResetBtn) saveResetBtn.disabled = true; 

                        printEmailBtn.disabled = true; 

                        

                        console.log("Sending fetch request with JSON body.");



                        const response = await fetch(GOOGLE_APPS_SCRIPT_WEB_APP_URL, {

                            method: 'POST',

                            mode: 'cors',

                            headers: {

                                'Content-Type': 'application/json',

                            },

                            body: JSON.stringify(formDataForSubmission)

                        });

                        console.log("Fetch request sent. Waiting for response.");



                        const responseData = await response.json();

                        console.log("Response received from Apps Script:", responseData);

                        if (responseData.status === 'SUCCESS') {

                            alert('Form data submitted successfully to Google Sheet! The form will now reset.');

                            resetForm();

                        } else {

                            alert('Failed to submit form data: ' + responseData.message + '. Please check console for details.');

                            console.error('Apps Script Error:', responseData.message);

                        }



                    } catch (error) {

                        console.error('Error submitting form data (network/fetch error):', error);

                        alert('Failed to submit form data. Please try again. Check console for network/script errors.');

                    } finally {

                        submitFormBtn.textContent = 'Submit'; 

                        submitFormBtn.disabled = false; 

                        if (saveResetBtn) saveResetBtn.disabled = false;

                        printEmailBtn.disabled = false;

                        console.log("Submit button re-enabled.");

                    }

                });

            } else {

                console.error("Submit button (id='submitFormBtn') not found in HTML. Saving won't work.");

            }





            // Reset Form Functionality (now only resets fields)

            function resetForm() {

                console.log("Resetting form.");

                // Reset main form fields

                contactIdInput.value = '';

                clientNameInput.value = '';

                cerNameSelect.value = '';

                cerRoleSelect.value = ''; // Reset CER Role to trigger default questions

                callDateTimeInput.value = '';

                reviewerNameSelect.value = '';

                otherReviewerNameInput.classList.add('hidden');

                otherReviewerNameInput.value = '';

                otherReviewerNameInput.removeAttribute('required');

                otherReviewerNameInput.style.borderColor = '';

                autofailTypeSelect.value = '';

                evaluationDateInput.valueAsDate = new Date(); 

                const now = new Date();

                now.setMinutes(now.getMinutes() - now.getTimezoneOffset());

                callDateTimeInput.value = now.toISOString().slice(0,16);

                durationInput.value = '';



                // Clear validation borders and error messages

                document.querySelectorAll('.text-red-500').forEach(el => el.classList.add('hidden'));

                document.querySelectorAll('[required]').forEach(input => input.style.borderColor = '');





                // Update questions based on the default selected CER role after resetting it

                updateFormQuestions(cerRoleSelect.value || 'Reviewed case handling'); // Re-apply default questions and recalculate

                console.log("Form fields reset. Scores recalculated.");

            }





            // PDF & Email Button functionality

            printEmailBtn.addEventListener('click', async () => {

                console.log('PDF & Email button clicked - Attempting PDF generation and Email...');



                const element = document.getElementById('mainFormContent'); 

                if (!element) {

                    console.error('Error: Form container not found for PDF generation.');

                    alert('Could not find the form to generate PDF. Please try again.');

                    return;

                }



                // Temporarily hide elements for cleaner PDF.

                const elementsToHide = [mainNav]; 

                if (submitFormBtn) elementsToHide.push(submitFormBtn); 

                if (printEmailBtn) elementsToHide.push(printEmailBtn); 

                if (saveResetBtn) elementsToHide.push(saveResetBtn); 



                const originalDisplays = [];

                elementsToHide.forEach(el => {

                    if (el) {

                        originalDisplays.push({ el: el, display: el.style.display });

                        el.style.display = 'none';

                    }

                });

                console.log("Elements hidden for PDF capture.");



                try {

                    const canvas = await html2canvas(element, {

                        scale: 2, 

                        useCORS: true, 

                        logging: false 

                    });

                    console.log("html2canvas capture complete.");

                    

                    const imgData = canvas.toDataURL('image/jpeg', 0.8); 

                    const imgWidth = 210; 

                    const pageHeight = 297; 

                    const imgHeight = canvas.height * imgWidth / canvas.width;

                    let heightLeft = imgHeight;



                    const { jsPDF } = window.jspdf;

                    const pdf = new jsPDF('p', 'mm', 'a4');

                    console.log("jsPDF initialized.");



                    let position = 0;

                    pdf.addImage(imgData, 'JPEG', 0, position, imgWidth, imgHeight, undefined, 'FAST'); 

                    heightLeft -= pageHeight;



                    while (heightLeft > -1) { 

                        position = heightLeft - imgHeight; 

                        pdf.addPage();

                        pdf.addImage(imgData, 'JPEG', 0, position, imgWidth, imgHeight, undefined, 'FAST'); 

                        heightLeft -= pageHeight;

                    }

                    console.log("PDF images added.");



                    // Generate a more specific filename

                    const contactIdForPdf = contactIdInput.value || 'UnknownContact';

                    const cerNameForPdf = cerNameSelect.value || 'UnknownCER';

                    const reviewDateForPdf = evaluationDateInput.value || 'UnknownDate';

                    pdf.save(`QA_Form_${contactIdForPdf}_${cerNameForPdf}_${reviewDateForPdf}.pdf`);

                    console.log("PDF saved.");



                    // Prepare email details

                    const cerNameVal = cerNameSelect.value;

                    const evaluationDateVal = evaluationDateInput.value;

                    const overallScoreVal = overallFinalPercentageDisplay.textContent;

                    const contactIdVal = contactIdInput.value;

                    const reviewerNameVal = reviewerNameSelect.value === 'Other' ? otherReviewerNameInput.value : reviewerNameSelect.value;





                    const subject = `Quality Assessment Form for Contact ID: ${contactIdVal || 'N/A'} - CER: ${cerNameVal || 'N/A'} - Date: ${evaluationDateVal || 'N/A'}.\n\nOverall Score: ${overallScoreVal || 'N/A'}`;

                    const mailtoLink = `mailto:?subject=${encodeURIComponent(subject)}`;

                    

                    window.location.href = mailtoLink;

                    alert('PDF generated and downloaded. Please attach the PDF manually to your email client.');

                    console.log("Mailto link triggered and alert shown.");



                } catch (error) {

                    console.error("Critical Error during PDF generation or mailto attempt:", error);

                    alert("Failed to generate PDF or open email client. Please check your browser console (F12) for details.");

                } finally {

                    // Always restore original display styles after operation

                    originalDisplays.forEach(({ el, display }) => {

                        if (el) el.style.display = display;

                    });

                    console.log("Elements restored.");

                }

            });



            // Initial setup on page load

            initializeForm();

        });

    </script>

</body>

</html>
