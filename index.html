<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quality Assessment Form - ICEA LION GROUP</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="style.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">


    <style>
        /* Custom styles for body and utility classes not directly in Tailwind's default */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom blue for ICEALION branding, as used in your login and form header */
        .icealion-blue {
            background-color: #1a73e8;
            color: white;
        }
        .icealion-orange-text {
            color: #f57c00;
        }
        .error-message {
            color: #dc2626; /* Red color for error messages */
            font-size: 0.875rem; /* Equivalent to text-sm */
            margin-top: 0.5rem; /* Equivalent to mt-2 */
            text-align: center;
        }

        /* Styles for section headers background */
        .section-header-bg {
            background-color: #1a73e8; /* A shade of blue for section headers */
        }
        /* Styles for numbered icons background colors */
        .icon-bg-orange { background-color: #f57c00; }
        .icon-bg-blue { background-color: #2196f3; }
        .icon-bg-green { background-color: #4caf50; }
        .icon-bg-yellow { background-color: #ffc107; }

        /* Row background colors for zebra striping effect */
        .form-row-light { background-color: #f9fafb; }
        .form-row-dark { background-color: #edf2f7; }

        /* Specific adjustments for input padding in grid layout */
        .form-grid-input {
            padding: 8px; /* Standard padding for basic info inputs */
        }

        /* Adjustments for main content display, positioned relative to body flow */
        body > .form-container,
        body > .reports-container {
            margin-top: 20px; /* Space from top */
            margin-bottom: 20px; /* Space at bottom */
            padding-left: 20px;
            padding-right: 20px;
            box-sizing: border-box; /* Ensure padding is included in element's total width */
        }

        /* Ensure main content containers are centered horizontally within the body flow */
        body {
            display: flex;
            flex-direction: column;
            align-items: center; /* Center content horizontally */
        }

        /* Progress bar (if applicable, though not directly used now, kept from snippet) */
        .progress-bar-container {
            background-color: #e0e0e0;
            border-radius: 9999px;
            overflow: hidden;
        }
        .progress-bar {
            background-color: #4CAF50;
            height: 10px;
            width: 24%; /* Example width, will be dynamic */
            border-radius: 9999px;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <nav class="main-nav" id="mainNav">
        <ul>
            <li><a href="index.html" class="active"><i class="fas fa-file-alt"></i> Audit Form</a></li>
            <li><a href="reports.html"><i class="fas fa-chart-bar"></i> Reports</a></li>
        </ul>
        <button id="logoutBtn" class="logout-button">Logout</button>
    </nav>

    <div class="login-container absolute inset-0 flex items-center justify-center p-4 md:p-8 z-10" id="loginPage">
        <div class="container mx-auto bg-white shadow-lg rounded-lg overflow-hidden max-w-md">
            <div class="icealion-blue p-6 rounded-t-lg text-center">
                <h1 class="text-2xl font-semibold">ICEALION GROUP Login</h1>
            </div>

            <form id="loginForm" class="p-8 space-y-6">
                <div>
                    <label for="username" class="block text-sm font-medium text-gray-700">Username</label>
                    <input type="text" id="username" name="username"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50 p-2 border"
                           required placeholder="Enter your username">
                </div>
                <div>
                    <label for="password" class="block text-sm font-medium text-gray-700">Password</label>
                    <input type="password" id="password" name="password"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50 p-2 border"
                           required placeholder="Enter your password">
                </div>
                <button type="submit"
                        class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-md shadow-md transition duration-300 ease-in-out">
                    Login
                </button>
                <div id="loginMessage" class="error-message hidden"></div>
            </form>
        </div>
    </div>

    <div class="container mx-auto bg-white shadow-lg rounded-lg overflow-hidden max-w-4xl" id="mainFormContent" style="display: none;">
        <div class="icealion-blue p-4 flex items-center justify-between">
            <div class="text-xl font-semibold">Quality Assessment Form - ICEALION GROUP Contact Centre</div>
            <img src="https://placehold.co/120x40/1a73e8/FFFFFF?text=ICEALION" alt="ICEALION Logo" class="h-10 rounded-md">
        </div>

        <div class="p-6 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
            <div>
                <label for="contact-id" class="block text-sm font-medium text-gray-700">Contact ID</label>
                <input type="text" id="contact-id" name="Contact ID" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 p-2 border form-grid-input" required>
            </div>
            <div>
                <label for="client-name" class="block text-sm font-medium text-gray-700">Client Name</label>
                <input type="text" id="client-name" name="Client Name" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 p-2 border form-grid-input" placeholder="e.g., John Doe" required>
            </div>
            <div>
                <label for="cer-name" class="block text-sm font-medium text-gray-700">CER Name</label>
                <select id="cer-name" name="CER Name" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 p-2 border form-grid-input" required>
                    <option value="">Select CER</option>
                    <option value="Ann Nyokabi">Ann Nyokabi</option>
                    <option value="Cliff Kiyaka">Cliff Kiyaka</option>
                    <option value="Edith watahi">Edith watahi</option>
                    <option value="Faith Irungu">Faith Irungu</option>
                    <option value="Ian Wanyagi">Ian Wanyagi</option>
                    <option value="Kelvin Nyagaka">Kelvin Nyagaka</option>
                    <option value="Lawrence Ochola">Lawrence Ochola</option>
                    <option value="Linnet Chege">Linnet Chege</option>
                    <option value="Margaret Mukulu">Margaret Mukulu</option>
                    <option value="Bonface Masiaga">Bonface Masiaga</option>
                    <option value="Maureen Ongola">Maureen Ongola</option>
                    <option value="Melinda Omballa">Melinda Omballa</option>
                    <option value="Nancy Wanjiku">Nancy Wanjiku</option>
                    <option value="Patricia Mumbi">Patricia Mumbi</option>
                    <option value="Philly Osikeh">Philly Osikeh</option>
                    <option value="Phina Owiti">Phina Owiti</option>
                    <option value="Sharon Wambugu">Sharon Wambugu</option>
                    <option value="Victor Kibet">Victor Kibet</option>
                    <option value="Harlod Mwiti">Harlod Mwiti</option>
                </select>
            </div>
            <div>
                <label for="cer-role" class="block text-sm font-medium text-gray-700">CER Role</label>
                <select id="cer-role" name="CER Role" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 p-2 border form-grid-input" required>
                    <option value="">Select Role</option>
                    <option value="Outbound Sales">Outbound Sales</option>
                    <option value="Onboarding outbound">Onboarding outbound</option>
                    <option value="Social Media">Social Media</option>
                    <option value="Live Chat">Live Chat</option>
                    <option value="Inbound">Inbound</option>
                    <option value="Email">Email</option>
                    <option value="Digital troubleshooting">Digital troubleshooting</option>
                    <option value="SMS">SMS</option>
                    <option value="NPS outbound">NPS outbound</option>
                    <option value="Reviewed case handling">Reviewed case handling</option>
                </select>
            </div>
            <div>
                <label for="call-date-time" class="block text-sm font-medium text-gray-700">Call Date and Time</label>
                <input type="datetime-local" id="call-date-time" name="Call Date and Time" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 p-2 border form-grid-input" required>
            </div>
            <div>
                <label for="reviewer-name" class="block text-sm font-medium text-gray-700">Reviewer's Name</label>
                <select id="reviewer-name" name="Reviewer's Name" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 p-2 border form-grid-input" required>
                    <option value="">Select Reviewer</option>
                    <option value="Rebecca Nduta">Rebecca Nduta</option>
                    <option value="Lawrence Ochola">Lawrence Ochola</option>
                    <option value="Other">Other</option>
                </select>
                <input type="text" id="other-reviewer-name" name="Other Reviewer Name" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 p-2 border form-grid-input hidden" placeholder="Enter Reviewer Name">
            </div>
            <div>
                <label for="autofail-type" class="block text-sm font-medium text-gray-700">Auto Fail Type</label>
                <select id="autofail-type" name="Auto Fail Type" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 p-2 border form-grid-input">
                    <option value="">Select Autofail Type</option>
                    <option value="First Contact Resolution">First Contact Resolution</option>
                    <option value="KYC">KYC</option>
                    <option value="Data Capture">Data Capture</option>
                    <option value="Follow-up & action items">Follow-up & action items</option>
                </select>
            </div>
            <div>
                <label for="review-date" class="block text-sm font-medium text-gray-700">Evaluation Date</label>
                <input type="date" id="review-date" name="Evaluation Date" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-ring-indigo-200 focus:ring-opacity-50 p-2 border form-grid-input" required>
            </div>
            <div>
                <label for="duration" class="block text-sm font-medium text-gray-700">Call Duration</label>
                <input type="text" id="duration" name="Call Duration" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 p-2 border form-grid-input" placeholder="e.g., 30 mins">
            </div>
        </div>

        <div class="p-4 rounded-lg shadow-sm flex flex-col items-center justify-center space-y-2 bg-gray-50 mx-6 mb-4">
            <div class="text-sm font-medium text-gray-600">Scores:</div>
            <div class="flex justify-around w-full gap-2">
                <div class="flex-1 text-center bg-gray-50 p-2 rounded-md">
                    <div class="text-xs font-medium text-gray-600 mb-1">Overall Score</div>
                    <div class="text-xl font-bold text-blue-600" id="overall-score-display">0%</div>
                </div>
                <div class="flex-1 text-center bg-gray-50 p-2 rounded-md">
                    <div class="text-xs font-medium text-gray-600 mb-1">Business & Compliance Accuracy</div>
                    <div class="text-xl font-bold text-blue-600" id="business-compliance-accuracy">0%</div>
                </div>
            </div>
        </div>

        <form id="assessment-form">
            <div class="mt-4">
                <div class="section-header-bg text-white p-3 font-semibold flex items-center gap-2">
                    <i class="fas fa-user tile-icon"></i> CUSTOMER EXPERIENCE
                </div>
                <div class="p-4">
                    <div class="grid grid-cols-12 gap-2 text-sm font-medium text-gray-700 mb-2">
                        <div class="col-span-6">Description</div>
                        <div class="col-span-2 text-center">Rating</div>
                        <div class="col-span-1 text-center">Weight</div>
                        <div class="col-span-1 text-center">Pnts</div>
                        <div class="col-span-2">Remarks</div>
                    </div>
                    <div id="cxQuestionsContainer">
                        </div>
                </div>
            </div>

            <div class="mt-4">
                <div class="section-header-bg text-white p-3 font-semibold flex items-center gap-2">
                    <i class="fas fa-lightbulb tile-icon"></i> PROBLEM SOLVING SKILLS
                </div>
                <div class="p-4">
                    <div class="grid grid-cols-12 gap-2 text-sm font-medium text-gray-700 mb-2">
                        <div class="col-span-6">Description</div>
                        <div class="col-span-2 text-center">Rating</div>
                        <div class="col-span-1 text-center">Weight</div>
                        <div class="col-span-1 text-center">Pnts</div>
                        <div class="col-span-2">Remarks</div>
                    </div>
                    <div id="psQuestionsContainer">
                        </div>
                </div>
            </div>

            <div class="mt-4">
                <div class="section-header-bg text-white p-3 font-semibold flex items-center gap-2">
                    <i class="fas fa-check-circle tile-icon"></i> COMPLIANCE AND BUSINESS CRITICAL ACCURACY
                </div>
                <div class="p-4">
                    <div class="grid grid-cols-12 gap-2 text-sm font-medium text-gray-700 mb-2">
                        <div class="col-span-6">Description</div>
                        <div class="col-span-2 text-center">Rating</div>
                        <div class="col-span-1 text-center">Weight</div>
                        <div class="col-span-1 text-center">Pnts</div>
                        <div class="col-span-2">Remarks</div>
                    </div>
                    <div id="caQuestionsContainer">
                        </div>
                </div>
            </div>

            <div class="p-6 flex flex-col items-end">
                <table class="score-summary-table w-full md:w-1/2 lg:w-1/3 text-right text-sm border-collapse border border-blue-500">
                    <tbody>
                        <tr class="border-b border-blue-500">
                            <td class="text-left font-medium p-2 border border-blue-500">Total Pts.</td>
                            <td class="text-right text-gray-500 p-2 border border-blue-500" id="total-pts-percentage">0%</td>
                        </tr>
                        <tr class="border-b border-blue-500">
                            <td class="text-left font-medium p-2 border border-blue-500">Available Pts.</td>
                            <td class="text-right text-gray-500 p-2 border border-blue-500">100%</td>
                        </tr>
                        <tr>
                            <td class="text-left font-bold icealion-orange-text p-2 border border-blue-500">Overall Score</td>
                            <td class="text-right font-bold icealion-orange-text p-2 border border-blue-500" id="overall-final-percentage-display">0%</td>
                        </tr>
                    </tbody>
                </table>
                <div class="flex items-center justify-between w-full mt-4">
                    <img src="https://placehold.co/150x50/FFFFFF/1a73e8?text=ICEALION%0AGROUP" alt="ICEALION Group" class="h-12 rounded-md">
                    <div class="flex space-x-4">
                        <button type="button" id="print-email-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-md shadow-md transition duration-300 ease-in-out">
                            PDF & Email
                        </button>
                        <button type="submit" id="submit-btn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-md shadow-md transition duration-300 ease-in-out">
                            Submit
                        </button>
                    </div>
                </div>
            </div>
        </form>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log("DOM fully loaded and parsed. Script starting.");

            // Login elements
            const loginPage = document.getElementById('loginPage');
            const loginForm = document.getElementById('loginForm');
            const usernameInput = document.getElementById('username');
            const passwordInput = document.getElementById('password');
            const loginMessage = document.getElementById('loginMessage');
            const mainFormContent = document.getElementById('mainFormContent');

            // Form buttons
            const printEmailBtn = document.getElementById('print-email-btn');
            const submitBtn = document.getElementById('submit-btn');

            // Basic Info Fields
            const contactIdInput = document.getElementById('contact-id');
            const clientNameInput = document.getElementById('client-name');
            const cerNameSelect = document.getElementById('cer-name');
            const cerRoleSelect = document.getElementById('cer-role');
            const callDateTimeInput = document.getElementById('call-date-time');
            const reviewerNameSelect = document.getElementById('reviewer-name');
            const otherReviewerNameInput = document.getElementById('other-reviewer-name');
            const autofailTypeSelect = document.getElementById('autofail-type');
            const evaluationDateInput = document.getElementById('review-date');
            const durationInput = document.getElementById('duration');

            // Score displays
            const overallScoreDisplay = document.getElementById('overall-score-display');
            const businessComplianceAccuracyDisplay = document.getElementById('business-compliance-accuracy');
            const totalPtsPercentageDisplay = document.getElementById('total-pts-percentage');
            const overallFinalPercentageDisplay = document.getElementById('overall-final-percentage-display');

            // Navigation and Logout
            const mainNav = document.getElementById('mainNav');
            const logoutBtn = document.getElementById('logoutBtn');

            // Dynamic question containers
            const cxQuestionsContainer = document.getElementById('cxQuestionsContainer');
            const psQuestionsContainer = document.getElementById('psQuestionsContainer');
            const caQuestionsContainer = document.getElementById('caQuestionsContainer');

            // --- Global Variables for Calculation ---
            let globalTotalPoints = 0;
            let globalMaxPossiblePoints = 0;
            let globalBusinessComplianceAccuracyValue = 0;

            // --- ALL Question Data by CER Role ---
            const allRolesQuestions = {
                // Default questions if no role is selected or for a generic base
                '': {
                    'CUSTOMER EXPERIENCE': [
                        // You can add default questions here if you want some to appear before a role is chosen
                    ],
                    'PROBLEM SOLVING SKILLS': [],
                    'COMPLIANCE AND BUSINESS CRITICAL ACCURACY': []
                },
                'Outbound Sales': {
                    'CUSTOMER EXPERIENCE': [
                        { desc: 'Did the CER provide proper branding and personalize the call?', weightage: 6 },
                        { desc: 'Did the CER demonstrate confidence and business etiquette althroughout the call session?', weightage: 8 },
                        { desc: 'Did the CER express a sincere acknowledgement/empathy statement when applicable?', weightage: 6 },
                        { desc: 'Did the CER convey his/her thoughts in an understandable clear and concise manner?', weightage: 8 },
                        { desc: 'Was the CER able to build rapport?', weightage: 8 }
                    ],
                    'PROBLEM SOLVING SKILLS': [
                        { desc: 'Did the CER ask effective probing questions to ensure accurate diagnosis?', weightage: 6 },
                        { desc: "Was the CER's focus solely on the Customer?", weightage: 7 },
                        { desc: 'Did the CER demonstrate strong Product Knowledge?', weightage: 10 },
                        { desc: 'Did the CER document all action items & follow-up? (Autofail)', weightage: 6, autofail: true },
                        { desc: 'Was the CER able to sell to the customer?', weightage: 10 }
                    ],
                    'COMPLIANCE AND BUSINESS CRITICAL ACCURACY': [
                        { desc: 'Did the CER log call information correctly? (Data capture)', weightage: 10, autofail: true },
                        { desc: 'Did the CER adhere to Company Policies & Procedures?(Autofail)', weightage: 5, autofail: true },
                        { desc: 'Did the CER Comply with industry and legal requirements?', weightage: 5 },
                        { desc: 'Was the CER able to identify and opportunity for Upselling & Cross-Selling?', weightage: 5 }
                    ]
                },
                'Social Media': {
                    'CUSTOMER EXPERIENCE': [
                        { desc: 'Did the CER provide proper branding and personalize the Interaction?', weightage: 5 },
                        { desc: 'Did the CER demonstrate confidence and business etiquette althroughout the interaction session?', weightage: 6 },
                        { desc: 'Did the CER express a sincere acknowledgement/empathy statement when applicable?', weightage: 7 },
                        { desc: 'Did the CER convey his/her thoughts in an understandable clear and concise manner?', weightage: 7 },
                        { desc: 'Did the CER keep the customer informed?(TAT, dead air)', weightage: 5 }
                    ],
                    'PROBLEM SOLVING SKILLS': [
                        { desc: 'Did the CER ask effective probing questions to ensure accurate diagnosis?', weightage: 9 },
                        { desc: 'Did the CER do proper research and check all related tools required?(Due diligence)', weightage: 7 },
                        { desc: 'Did the CER show ownership and respond within the set turnaround time? (10 mins)', weightage: 6 },
                        { desc: 'Was the CER able to position all possible options to the customer?(FCR)', weightage: 13, autofail: true },
                        { desc: 'Did the CER avoid risk behavior? (interaction avoidance/ZTP)', weightage: 8 }
                    ],
                    'COMPLIANCE AND BUSINESS CRITICAL ACCURACY': [
                        { desc: 'Did the CER log ticket information correctly?(Data capture)', weightage: 6, autofail: true },
                        { desc: 'Did the CER properly authenticate the customer?(KYC)', weightage: 8, autofail: true },
                        { desc: 'Did the CER provide complete and accurate information?(Customer education)', weightage: 10 },
                        { desc: 'Did the CER identify an opportunity to upsell/cross sell a product?', weightage: 5 }
                    ]
                },
                'Live Chat': {
                    'CUSTOMER EXPERIENCE': [
                        { desc: 'Did the CER provide proper branding and personalize the conversation?', weightage: 5 },
                        { desc: 'Did the CER demonstrate confidence and business etiquette althroughout the conversation session?', weightage: 7 },
                        { desc: 'Did the CER express a sincere acknowledgement/empathy statement when applicable?', weightage: 7 },
                        { desc: 'Did the CER convey his/her thoughts in an understandable clear and concise manner?', weightage: 6 },
                        { desc: 'Did the CER keep the customer informed?(Dead Air-Average Response Time 1 min, TAT, )', weightage: 5 }
                    ],
                    'PROBLEM SOLVING SKILLS': [
                        { desc: 'Did the CER ask effective probing questions to ensure accurate diagnosis?', weightage: 9 },
                        { desc: 'Did the CER do proper research and check all related tools required?', weightage: 7 },
                        { desc: 'Did the CER show ownership and respond within the set turnaround time? (10 Secs)', weightage: 6 },
                        { desc: 'Was the CER able to position all possible options to the customer?(FCR)', weightage: 13, autofail: true },
                        { desc: 'Did the CER avoid risk behavior? (conversation avoidance/ZTP)', weightage: 8 }
                    ],
                    'COMPLIANCE AND BUSINESS CRITICAL ACCURACY': [
                        { desc: 'Did the CER log ticket information correctly?(Data Capture)', weightage: 6, autofail: true },
                        { desc: 'Did the CER properly authenticate the customer?(KYC)', weightage: 8, autofail: true },
                        { desc: 'Did the CER provide complete and accurate information?(Customer education)', weightage: 9 },
                        { desc: 'Did the CER identify an opportunity to upsell/cross sell a product?', weightage: 5 }
                    ]
                },
                'Inbound': {
                    'CUSTOMER EXPERIENCE': [
                        { desc: 'Did the CER provide proper branding and personalize the call?', weightage: 6 },
                        { desc: 'Did the CER demonstrate confidence and business etiquette althroughout the call session?', weightage: 6 },
                        { desc: 'Did the CER express a sincere acknowledgement/empathy statement when applicable?', weightage: 8 },
                        { desc: 'Did the CER convey his/her thoughts in an understandable clear and concise manner?', weightage: 4 },
                        { desc: 'Did the CER keep the caller informed?(Dead air/Hold/TAT)', weightage: 6 }
                    ],
                    'PROBLEM SOLVING SKILLS': [
                        { desc: 'Did the CER ask effective probing questions to ensure accurate diagnosis?', weightage: 6 },
                        { desc: 'Did the CER do proper research and check all related tools required? (fact finding)', weightage: 7 },
                        { desc: 'Did the CER show ownership and actively listen?', weightage: 9 },
                        { desc: 'Was the CER able to position all possible options to the customer?(FCR)', weightage: 10, autofail: true },
                        { desc: 'Did the CER avoid risk behavior? (Call avoidance/ZTP)', weightage: 7 }
                    ],
                    'COMPLIANCE AND BUSINESS CRITICAL ACCURACY': [
                        { desc: 'Did the CER log call information correctly?(Data capture)', weightage: 10, autofail: true },
                        { desc: 'Did the CER properly authenticate the caller?(KYC)', weightage: 6, autofail: true },
                        { desc: 'Did the CER provide complete and accurate information? (Customer education)', weightage: 9 },
                        { desc: 'Did the CER identify an opportunity to upsell/cross sell a product?', weightage: 5 }
                    ]
                },
                'Email': {
                    'CUSTOMER EXPERIENCE': [
                        { desc: 'Did the CER provide proper branding and personalize the email?', weightage: 5 },
                        { desc: 'Did the CER demonstrate confidence and business etiquette althroughout the interaction?', weightage: 7 },
                        { desc: 'Did the CER express a sincere acknowledgement/empathy statement when applicable?', weightage: 7 },
                        { desc: 'Did the CER convey his/her thoughts in an understandable clear and concise manner?', weightage: 6 },
                        { desc: 'Did the CER keep the customer informed?', weightage: 5 }
                    ],
                    'PROBLEM SOLVING SKILLS': [
                        { desc: 'Did the CER call to ask effective probing questions to ensure accurate diagnosis?', weightage: 9 },
                        { desc: 'Did the CER do proper research and check all related tools required?', weightage: 7 },
                        { desc: 'Did the CER show ownership and respond within the set turnaround time?(8 hours)', weightage: 6 },
                        { desc: 'Was the CER able to position all possible options to the customer?', weightage: 13, autofail: true },
                        { desc: 'Did the CER avoid risk behavior? (Call avoidance/ZTP)', weightage: 8 }
                    ],
                    'COMPLIANCE AND BUSINESS CRITICAL ACCURACY': [
                        { desc: 'Did the CER log ticket information correctly?', weightage: 6, autofail: true },
                        { desc: 'Did the CER properly authenticate the writer?', weightage: 8, autofail: true },
                        { desc: 'Did the CER provide complete and accurate information?(Customer education)', weightage: 9 },
                        { desc: 'Did the CER identify an opportunity to upsell/cross sell a product?', weightage: 5 }
                    ]
                },
                'Digital troubleshooting': {
                    'CUSTOMER EXPERIENCE': [
                        { desc: 'Did the Agent provide proper branding and personalize the call?', weightage: 6 },
                        { desc: 'Did the Agent demonstrate confidence and business etiquette althroughout the call session?', weightage: 6 },
                        { desc: 'Did the Agent express a sincere acknowledgement/empathy statement when applicable?', weightage: 7 },
                        { desc: 'Did the Agent convey his/her thoughts in an understandable clear and concise manner?', weightage: 7 },
                        { desc: 'Did the Agent keep the caller informed?', weightage: 5 }
                    ],
                    'PROBLEM SOLVING SKILLS': [
                        { desc: 'Did the Agent ask effective probing questions to ensure accurate diagnosis?', weightage: 5.5 },
                        { desc: 'Did the Agent do proper research and check all related tools required?', weightage: 11 },
                        { desc: 'Did the Agent show ownership and actively listen?', weightage: 6 },
                        { desc: 'Was the Agent able to position all possible options to the customer?', weightage: 10.5, autofail: true },
                        { desc: 'Did the agent avoid risk behavior? (Call avoidance/ZTP)', weightage: 7 }
                    ],
                    'COMPLIANCE AND BUSINESS CRITICAL ACCURACY': [
                        { desc: 'Did the Agent log call information correctly?', weightage: 7, autofail: true },
                        { desc: 'Did the Agent properly authenticate the caller?', weightage: 8, autofail: true },
                        { desc: 'Did the Agent provide complete and accurate information?', weightage: 9 },
                        { desc: 'Did the Agent identify an opportunity to upsell/cross sell a product?', weightage: 5 }
                    ]
                },
                'SMS': {
                    'CUSTOMER EXPERIENCE': [
                        { desc: 'Did the CER provide proper branding and personalize the conversation?', weightage: 5 },
                        { desc: 'Did the CER demonstrate confidence and business etiquette all throughout the conversation session?', weightage: 7 },
                        { desc: 'Did the CER express a sincere acknowledgement/empathy statement when applicable?', weightage: 7 },
                        { desc: 'Did the CER convey his/her thoughts in an understandable clear and concise manner?', weightage: 6 },
                        { desc: 'Did the CER keep the customer informed?(Dead air, TAT)', weightage: 5 }
                    ],
                    'PROBLEM SOLVING SKILLS': [
                        { desc: 'Did the CER ask effective probing questions to ensure accurate diagnosis?', weightage: 9 },
                        { desc: 'Did the CER do proper research and check all related tools required?(fact finding)', weightage: 7 },
                        { desc: 'Did the CER show ownership and respond within the set turnaround time?(5 mins)', weightage: 6 },
                        { desc: 'Was the CER able to position all possible options to the customer?(FCR)', weightage: 13, autofail: true },
                        { desc: 'Did the CER avoid risk behavior? (conversation avoidance/ZTP)', weightage: 8 }
                    ],
                    'COMPLIANCE AND BUSINESS CRITICAL ACCURACY': [
                        { desc: 'Did the CER log ticket information correctly?(Data capture)', weightage: 6, autofail: true },
                        { desc: 'Did the CER properly authenticate the customer?(KYC)', weightage: 8, autofail: true },
                        { desc: 'Did the CER provide complete and accurate information? (Customer education)', weightage: 9 },
                        { desc: 'Did the CER identify an opportunity to upsell/cross sell a product?', weightage: 5 }
                    ]
                },
                'NPS outbound': {
                    'CUSTOMER EXPERIENCE': [
                        { desc: 'Did the Agent provide proper branding and personalize the call?', weightage: 6 },
                        { desc: 'Did the Agent demonstrate confidence and business etiquette althroughout the call session?', weightage: 6 },
                        { desc: 'Did the Agent express a sincere acknowledgement/empathy statement when applicable?', weightage: 7 },
                        { desc: 'Did the Agent convey his/her thoughts in an understandable clear and concise manner?', weightage: 7 },
                        { desc: 'Did the Agent keep the caller informed?', weightage: 5 }
                    ],
                    'PROBLEM SOLVING SKILLS': [
                        { desc: 'Did the Agent ask effective probing questions to ensure accurate diagnosis?', weightage: 8 },
                        { desc: 'Did the Agent do proper research and check all related tools required?', weightage: 7 },
                        { desc: 'Did the Agent show ownership and actively listen?', weightage: 6 },
                        { desc: 'Was the Agent able to position all possible options to the customer? Create a ticket where necessary', weightage: 11, autofail: true },
                        { desc: 'Did the agent avoid risk behavior? (Call avoidance/ZTP)', weightage: 7 }
                    ],
                    'COMPLIANCE AND BUSINESS CRITICAL ACCURACY': [
                        { desc: 'Did the Agent log call information correctly?', weightage: 7, autofail: true },
                        { desc: 'Did the Agent confirm the feedback from the customer and put it vebatim on the survey form?', weightage: 10, autofail: true },
                        { desc: 'Did the Agent provide complete and accurate information?', weightage: 9 },
                        { desc: 'Did the Agent identify an opportunity to upsell/cross sell a product?', weightage: 5 }
                    ]
                },
                'Onboarding outbound': {
                    'CUSTOMER EXPERIENCE': [
                        { desc: 'Did the CER provide proper branding and personalize the call?', weightage: 6 },
                        { desc: 'Did the CER demonstrate confidence and business etiquette althroughout the call session?', weightage: 7 },
                        { desc: 'Did the CER express a sincere acknowledgement/empathy statement when applicable?', weightage: 6 },
                        { desc: 'Did the CER convey his/her thoughts in an understandable clear and concise manner?', weightage: 6 },
                        { desc: 'Was the CER able to build rapport?', weightage: 8 }
                    ],
                    'PROBLEM SOLVING SKILLS': [
                        { desc: 'Did the CER ask effective probing questions to ensure accurate diagnosis?', weightage: 5 },
                        { desc: 'Did the CER do proper research and check all related tools required?', weightage: 7 },
                        { desc: 'Did the CER demonstrate strong Product and Process Knowledge?', weightage: 10 },
                        { desc: 'Was the CER able to meet the call objective? (FCR)', weightage: 10, autofail: true },
                        { desc: 'Did the CER document all action items & follow-up?', weightage: 8 }
                    ],
                    'COMPLIANCE AND BUSINESS CRITICAL ACCURACY': [
                        { desc: 'Did the CER log call information correctly?', weightage: 10, autofail: true },
                        { desc: 'Did the CER adhere to Company Policies & Procedures?', weightage: 5, autofail: true },
                        { desc: 'Did the CER Comply with industry and legal requirements?', weightage: 5 },
                        { desc: 'Was the CER able to identify and opportunity for Upselling & Cross-Selling?', weightage: 7 }
                    ]
                },
                'Reviewed case handling': {
                     // Placeholder for this role, add questions as needed
                    'CUSTOMER EXPERIENCE': [],
                    'PROBLEM SOLVING SKILLS': [],
                    'COMPLIANCE AND BUSINESS CRITICAL ACCURACY': []
                }
            };

            // Mapping of section titles to their container elements
            const questionContainers = {
                'CUSTOMER EXPERIENCE': cxQuestionsContainer,
                'PROBLEM SOLVING SKILLS': psQuestionsContainer,
                'COMPLIANCE AND BUSINESS CRITICAL ACCURACY': caQuestionsContainer
            };

            // --- Function to Render Questions based on Selected Role ---
            function renderQuestionsForRole(role) {
                console.log("Rendering questions for role:", role);

                // Clear all existing questions from containers
                for (const key in questionContainers) {
                    questionContainers[key].innerHTML = '';
                }

                const roleQuestions = allRolesQuestions[role];

                if (!roleQuestions) {
                    console.warn(`No questions defined for role: ${role}. Displaying empty sections.`);
                    calculateScore(); // Recalculate with empty fields
                    return;
                }

                let questionNumber = 1; // Global question counter for display

                for (const sectionTitle in roleQuestions) {
                    const questions = roleQuestions[sectionTitle];
                    const container = questionContainers[sectionTitle];

                    if (!container) {
                        console.error(`Container not found for section: ${sectionTitle}`);
                        continue;
                    }

                    questions.forEach(q => {
                        const rowDiv = document.createElement('div');
                        rowDiv.className = `grid grid-cols-12 gap-2 py-2 items-center rounded-md mb-2 p-2 ${questionNumber % 2 === 1 ? 'form-row-light' : 'form-row-dark'}`;

                        // Determine icon color based on question number (cycle through orange, blue, green, yellow)
                        let iconColorClass;
                        const iconIndex = (questionNumber - 1) % 4; // 0, 1, 2, 3
                        if (iconIndex === 0) iconColorClass = 'icon-bg-orange';
                        else if (iconIndex === 1) iconColorClass = 'icon-bg-blue';
                        else if (iconIndex === 2) iconColorClass = 'icon-bg-green';
                        else iconColorClass = 'icon-bg-yellow';

                        rowDiv.innerHTML = `
                            <div class="col-span-6 flex items-center gap-2">
                                <span class="${iconColorClass} rounded-full p-1 text-white text-xs inline-flex items-center justify-center w-6 h-6">${questionNumber}</span>
                                ${q.desc}
                            </div>
                            <div class="col-span-2">
                                <select name="${q.desc} (Rating)" class="w-full rounded-md border-gray-300 shadow-sm p-1 text-center border rating-select" ${q.autofail ? 'data-autofail-question="true"' : ''}>
                                    <option value="" selected>None</option>
                                    <option value="Yes">Yes</option>
                                    <option value="No">No</option>
                                </select>
                            </div>
                            <div class="col-span-1 text-center weightage-display" data-weightage="${q.weightage}">${q.weightage}</div>
                            <div class="col-span-1 text-center">
                                <input type="number" name="${q.desc} (Points)" class="w-full text-center p-1 border rounded-md points-input" value="0" readonly placeholder="0">
                            </div>
                            <div class="col-span-2">
                                <textarea name="${q.desc} (Remarks)" rows="1" class="w-full rounded-md border-gray-300 shadow-sm p-1 border remarks-textarea"></textarea>
                            </div>
                        `;
                        container.appendChild(rowDiv);

                        // Attach event listener to the newly created select element
                        const newSelect = rowDiv.querySelector('.rating-select');
                        if (newSelect) {
                            newSelect.addEventListener('change', calculateScore);
                        }
                        questionNumber++;
                    });
                }
                calculateScore(); // Recalculate scores after new questions are rendered
            }

            // --- Calculate Score Function (updated to work with dynamic elements) ---
            const calculateScore = () => {
                console.log("calculateScore called (dynamic).");
                globalTotalPoints = 0;
                globalMaxPossiblePoints = 0;
                let autofailTriggered = false;

                let complianceCurrentPoints = 0;
                let complianceMaxPoints = 0;

                // Find all rating selects currently in the DOM
                const allRatingSelects = document.querySelectorAll('.rating-select');

                allRatingSelects.forEach(selectElement => {
                    const rowDiv = selectElement.closest('.grid.grid-cols-12.gap-2.py-2');
                    if (!rowDiv) return; // Should not happen

                    const pointsElement = rowDiv.querySelector('.points-input');
                    const weightageDisplay = rowDiv.querySelector('.weightage-display');
                    const isAutofailQuestion = selectElement.hasAttribute('data-autofail-question');
                    const questionText = selectElement.name.replace(' (Rating)', ''); // Get the clean question text

                    if (!pointsElement || !weightageDisplay) {
                        console.warn(`Missing associated elements for select: ${selectElement.name}`);
                        return;
                    }

                    const rating = selectElement.value;
                    const weightage = parseFloat(weightageDisplay.dataset.weightage);
                    let currentPoints = 0;

                    // Reset background color before applying new logic
                    pointsElement.style.backgroundColor = '#e9ecef';
                    pointsElement.style.color = '#555';

                    if (rating === 'Yes') {
                        currentPoints = weightage;
                        pointsElement.readOnly = false;
                        pointsElement.style.backgroundColor = '#fff';
                    } else if (rating === 'No') {
                        currentPoints = 0;
                        pointsElement.readOnly = true;

                        if (isAutofailQuestion) {
                            pointsElement.style.backgroundColor = '#fca5a5';
                            pointsElement.style.color = '#dc2626';
                            autofailTriggered = true; // Trigger autofail if any autofail question is 'No'
                        } else {
                            pointsElement.style.backgroundColor = '#e0e0e0';
                        }
                    } else { // Handle 'None' or empty selection
                        currentPoints = 0;
                        pointsElement.readOnly = true;
                        pointsElement.style.backgroundColor = '#e9ecef';
                    }

                    pointsElement.value = currentPoints;
                    globalTotalPoints += currentPoints;
                    globalMaxPossiblePoints += weightage; // Sum all possible weightages from active questions

                    // Check if this question belongs to 'COMPLIANCE AND BUSINESS CRITICAL ACCURACY' for its specific score
                    // This relies on the question text mapping (e.g., "Did the CER log ticket information correctly?")
                    const currentRole = cerRoleSelect.value;
                    if (currentRole && allRolesQuestions[currentRole] && allRolesQuestions[currentRole]['COMPLIANCE AND BUSINESS CRITICAL ACCURACY']) {
                        const complianceQuestions = allRolesQuestions[currentRole]['COMPLIANCE AND BUSINESS CRITICAL ACCURACY'].map(q => q.desc);
                        if (complianceQuestions.includes(questionText)) {
                            if (rating === 'Yes') {
                                complianceCurrentPoints += weightage;
                            }
                            if (rating === 'Yes' || rating === 'No') { // Only add to max if an answer was provided
                                 complianceMaxPoints += weightage;
                            }
                        }
                    }
                });

                let overallPercentage = 0;
                if (autofailTriggered) {
                    overallPercentage = 0;
                } else {
                    if (globalMaxPossiblePoints > 0) {
                        overallPercentage = ((globalTotalPoints / globalMaxPossiblePoints) * 100).toFixed(0);
                    } else {
                        overallPercentage = 0;
                    }
                }

                overallScoreDisplay.textContent = `${overallPercentage}%`;
                totalPtsPercentageDisplay.textContent = `${overallPercentage}%`;
                overallFinalPercentageDisplay.textContent = `${overallPercentage}%`;

                let businessCompliancePct = 0;
                if (complianceMaxPoints > 0) {
                    businessCompliancePct = ((complianceCurrentPoints / complianceMaxPoints) * 100).toFixed(0);
                } else {
                    businessCompliancePct = 0;
                }
                businessComplianceAccuracyDisplay.textContent = `${businessCompliancePct}%`;

                globalBusinessComplianceAccuracyValue = businessCompliancePct;
            };

            // --- Initialize Form (on load or after login) ---
            function initializeForm() {
                console.log("Initializing form.");
                // Set default date to today
                evaluationDateInput.valueAsDate = new Date();
                // Set default call date and time to now
                const now = new Date();
                now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
                callDateTimeInput.value = now.toISOString().slice(0,16);

                // Set initial CER Role to empty to show no questions initially
                cerRoleSelect.value = '';
                renderQuestionsForRole(''); // Render an empty set of questions initially
                calculateScore(); // Ensure scores are 0%

                printEmailBtn.classList.remove('hidden');
                submitBtn.classList.remove('hidden');
            }


            // --- Login Logic ---
            const CORRECT_USERNAME = 'Supervisor';
            const CORRECT_PASSWORD = 'Supervisor';

            const showLoginErrorMessage = (message) => {
                loginMessage.textContent = message;
                loginMessage.classList.remove('hidden');
            };

            const hideLoginErrorMessage = () => {
                loginMessage.classList.add('hidden');
                loginMessage.textContent = '';
            };

            // Check for login state on page load
            const isLoggedIn = sessionStorage.getItem('loggedIn');

            if (isLoggedIn === 'true') {
                loginPage.style.display = 'none';
                mainFormContent.style.display = 'block';
                mainNav.style.display = 'flex';
                initializeForm(); // Call initialize form on successful login or refresh if already logged in
            } else {
                loginPage.style.display = 'flex';
                mainFormContent.style.display = 'none';
                mainNav.style.display = 'none';
            }

            loginForm.addEventListener('submit', function(event) {
                event.preventDefault();
                hideLoginErrorMessage();

                const enteredUsername = usernameInput.value;
                const enteredPassword = passwordInput.value;

                if (enteredUsername === CORRECT_USERNAME && enteredPassword === CORRECT_PASSWORD) {
                    sessionStorage.setItem('loggedIn', 'true');
                    loginPage.style.display = 'none';
                    mainFormContent.style.display = 'block';
                    mainNav.style.display = 'flex';
                    initializeForm(); // Call initialize form after successful login
                } else {
                    showLoginErrorMessage('Invalid Username or Password. Please try again.');
                }
            });

            // Logout functionality
            if (logoutBtn) {
                logoutBtn.addEventListener('click', function() {
                    sessionStorage.removeItem('loggedIn');
                    window.location.href = 'index.html';
                });
            }

            // Toggle 'Other' reviewer name input
            reviewerNameSelect.addEventListener('change', () => {
                if (reviewerNameSelect.value === 'Other') {
                    otherReviewerNameInput.classList.remove('hidden');
                    otherReviewerNameInput.setAttribute('required', 'required');
                } else {
                    otherReviewerNameInput.classList.add('hidden');
                    otherReviewerNameInput.value = '';
                    otherReviewerNameInput.removeAttribute('required');
                    otherReviewerNameInput.style.borderColor = '';
                }
            });

            // --- Event Listener for CER Role Change ---
            cerRoleSelect.addEventListener('change', (event) => {
                const selectedRole = event.target.value;
                renderQuestionsForRole(selectedRole);
                resetFormFieldsButKeepRole(); // Reset answers, but keep selected role
            });


            // Handle form submission (for saving data to Google Sheet via Apps Script)
            const assessmentForm = document.getElementById('assessment-form');
            submitBtn.addEventListener('click', async (event) => {
                event.preventDefault();
                console.log("Submit button clicked - attempting form submission.");

                // Basic client-side validation for required fields
                const requiredInputs = assessmentForm.querySelectorAll('[required]:not(.hidden)');
                let allRequiredFilled = true;
                for (const input of requiredInputs) {
                    if (input.value.trim() === '' || (input.tagName === 'SELECT' && input.value === '')) {
                        allRequiredFilled = false;
                        input.style.borderColor = 'red';
                        input.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        input.focus();
                        alert('Please fill out all required fields.');
                        return;
                    } else {
                        input.style.borderColor = '';
                    }
                }

                // Dynamically collect all relevant form data based on current DOM
                const formDataForSubmission = {};

                // Collect basic info fields by their 'name' attribute (note: names are now full descriptions)
                const basicInfoInputs = document.querySelectorAll('.p-6.grid.grid-cols-1 input, .p-6.grid.grid-cols-1 select');
                basicInfoInputs.forEach(input => {
                    if (input.name) {
                        if (input.type === 'datetime-local' || input.type === 'date') {
                            formDataForSubmission[input.name] = input.value;
                        } else if (input.id === 'other-reviewer-name' && input.classList.contains('hidden')) {
                            // Skip hidden 'other reviewer' field if not active
                            return;
                        }
                        else {
                            formDataForSubmission[input.name] = input.value.trim();
                        }
                    }
                });


                // Collect Overall Scores
                formDataForSubmission['Overall Score'] = overallScoreDisplay.textContent;
                formDataForSubmission['Business & Compliance Accuracy'] = businessComplianceAccuracyDisplay.textContent;
                formDataForSubmission['Total Pts.'] = globalTotalPoints;
                formDataForSubmission['Available Pts.'] = globalMaxPossiblePoints;
                formDataForSubmission['Final Score'] = overallFinalPercentageDisplay.textContent;

                // Loop through all dynamically created question elements
                const dynamicSelects = document.querySelectorAll('.rating-select');
                dynamicSelects.forEach(selectElement => {
                    const rowDiv = selectElement.closest('.grid.grid-cols-12.gap-2.py-2');
                    if (rowDiv) {
                        const pointsElement = rowDiv.querySelector('.points-input');
                        const remarksElement = rowDiv.querySelector('.remarks-textarea');

                        // Use the 'name' attributes which are set to the full question text + (Rating/Points/Remarks)
                        formDataForSubmission[selectElement.name] = selectElement.value;
                        if (pointsElement) {
                            formDataForSubmission[pointsElement.name] = pointsElement.value;
                        }
                        if (remarksElement) {
                            formDataForSubmission[remarksElement.name] = remarksElement.value.trim();
                        }
                    }
                });


                console.log("Collected Data for Submission:", formDataForSubmission);

                // **IMPORTANT**: This is your provided Google Apps Script Web App URL
                const GOOGLE_APPS_SCRIPT_WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbyUMQFf8kGWss0uTZSzjc4gka87kElaGyAksa-YNZyvH02r623UfnOOgSe2T9XFiClIQQ/exec';

                try {
                    submitBtn.textContent = 'Submitting...';
                    submitBtn.disabled = true;
                    console.log("Sending fetch request with JSON body.");

                    const response = await fetch(GOOGLE_APPS_SCRIPT_WEB_APP_URL, {
                        method: 'POST',
                        mode: 'cors',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(formDataForSubmission)
                    });
                    console.log("Fetch request sent. Waiting for response.");

                    const responseData = await response.json();
                    console.log("Response received from Apps Script:", responseData);
                    if (responseData.status === 'SUCCESS') {
                        alert('Form data submitted successfully to Google Sheet! The form will now reset.');
                        resetForm(); // Reset all form fields, including CER role
                    } else {
                        alert('Failed to submit form data: ' + responseData.message + '. Please check console for details.');
                        console.error('Apps Script Error:', responseData.message);
                    }

                } catch (error) {
                    console.error('Error submitting form data (network/fetch error):', error);
                    alert('Failed to submit form data. Please try again. Check console for network/script errors.');
                } finally {
                    submitBtn.textContent = 'Submit';
                    submitBtn.disabled = false;
                    console.log("Submit button re-enabled.");
                }
            });

            // Reset Form Functionality - Clears all fields including CER role
            function resetForm() {
                console.log("Full form reset.");

                // Reset basic info fields
                contactIdInput.value = '';
                clientNameInput.value = '';
                cerNameSelect.value = '';
                cerRoleSelect.value = ''; // Reset CER Role to empty

                // Reset date/time to current values
                const now = new Date();
                now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
                callDateTimeInput.value = now.toISOString().slice(0,16);
                evaluationDateInput.valueAsDate = new Date();

                durationInput.value = '';
                autofailTypeSelect.value = '';

                // Reset reviewer name and hide 'Other' input
                reviewerNameSelect.value = '';
                otherReviewerNameInput.classList.add('hidden');
                otherReviewerNameInput.value = '';
                otherReviewerNameInput.removeAttribute('required');
                otherReviewerNameInput.style.borderColor = '';

                // Re-render questions for the empty/default role, which effectively clears them
                renderQuestionsForRole('');
            }

            // New function to reset only question-related fields, keeping CER role selection
            function resetFormFieldsButKeepRole() {
                console.log("Resetting question fields only.");

                // Reset all dynamically created question select, points, and remarks elements
                const dynamicSelects = document.querySelectorAll('.rating-select');
                dynamicSelects.forEach(selectElement => {
                    selectElement.value = ''; // Set to empty string for 'None' option
                    selectElement.style.borderColor = ''; // Clear red border if any

                    const rowDiv = selectElement.closest('.grid.grid-cols-12.gap-2.py-2');
                    if (rowDiv) {
                        const pointsElement = rowDiv.querySelector('.points-input');
                        const remarksElement = rowDiv.querySelector('.remarks-textarea');

                        if (pointsElement) {
                            pointsElement.value = 0;
                            pointsElement.readOnly = true;
                            pointsElement.style.backgroundColor = '#e9ecef';
                            pointsElement.style.color = '#555';
                        }
                        if (remarksElement) {
                            remarksElement.value = '';
                        }
                    }
                });
                calculateScore(); // Recalculate scores after resetting
            }

            // Initial form setup when the page loads (or after login)
            // The initial state of questions is handled by initializeForm calling renderQuestionsForRole('')
        });
    </script>
</body>
</html>
