<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Evaluations - ICEA LION GROUP</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            display: flex;
            align-items: flex-start;
            min-height: 100vh;
            background-color: #f3f4f6;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            visibility: hidden;
            opacity: 0;
            transition: visibility 0s, opacity 0.3s ease;
        }
        body.loaded { visibility: visible; opacity: 1; }
        .icealion-blue { background-color: #1a73e8; color: white; }
        .main-content-container {
            margin-left: calc(125px + 1.5rem);
            margin-top: calc(48px + 1.5rem);
            width: calc(100% - 125px - 3rem);
            min-height: calc(100vh - 48px - 3rem);
            max-width: none;
            border-radius: 0.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            background-color: white;
            padding: 2rem;
            display: block; /* This container is always visible */
        }
        .main-nav {
            width: 125px; background-color: #800080; color: white; padding: 1rem 0; height: calc(100vh - 48px);
            position: fixed; top: 48px; left: 0; z-index: 100; box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
            display: flex; flex-direction: column; justify-content: space-between;
        }
        .main-nav ul { list-style: none; padding: 0; margin: 0; flex-grow: 1; }
        .sidebar ul li a { color: white; text-decoration: none; font-weight: 500; padding: 0.75rem 0.5rem; display: flex; flex-direction: column; align-items: center; gap: 0.25rem; font-size: 0.75rem; text-align: center; }
        .sidebar ul li a:hover, .sidebar ul li a.active { background-color: #6a006a; }
        .logout-button { background-color: #f57c00; color: white; padding: 0.5rem 0.75rem; border-radius: 0.375rem; font-weight: 600; cursor: pointer; border: none; transition: background-color 0.3s ease; margin: 1rem auto; width: calc(100% - 2rem); font-size: 0.75rem; }
        .logout-button:hover { background-color: #e65100; }
        .my-evaluations-card {
            background-color: #fff;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 2rem;
            margin-bottom: 1.5rem;
        }
        .my-evaluations-card h2 {
            font-size: 1.5rem;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 1rem;
        }
        .my-evaluations-card table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.875rem;
        }
        .my-evaluations-card th, .my-evaluations-card td {
            border-bottom: 1px solid #e5e7eb;
            padding: 0.75rem 0.5rem;
            text-align: left;
        }
        .my-evaluations-card th {
            font-weight: 600;
            background-color: #eff6ff;
            color: #1f2937;
        }
        .my-evaluations-card tbody tr:hover {
            background-color: #f3f4f6;
        }
        .top-header { position: fixed; top: 0; left: 0; width: 100%; height: 48px; background-color: #800080; color: white; display: flex; align-items: center; justify-content: center; font-size: 1.125rem; font-weight: 600; z-index: 1000; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2); }
        .top-header .logo-container { position: absolute; left: 1rem; }
        .top-header .logo-container img { height: 40px; }
        .notification-bell { color: white; font-size: 1.25rem; cursor: pointer; position: absolute; right: 1rem; }
        .notification-bell .badge { position: absolute; top: 0; right: 0; background-color: #e04b4b; color: white; border-radius: 50%; padding: 2px 6px; font-size: 0.75rem; border: 1px solid white; display: none; }
        .notification-bell.active .badge { display: block; }
        .notification-bell .fas.fa-bell { animation: ring 2s infinite ease-in-out; }
        @keyframes ring { 0% { transform: rotate(0); } 10% { transform: rotate(15deg); } 20% { transform: rotate(-15deg); } 30% { transform: rotate(15deg); } 40% { transform: rotate(-15deg); } 50% { transform: rotate(0); } 100% { transform: rotate(0); } }
        .hidden { display: none !important; }
    </style>
</head>
<body>
    <div class="top-header">
        <div id="headerLogoContainer" class="logo-container hidden">
            <img id="headerLogo" src="" alt="ICEALION Logo">
        </div>
        <span>ICEA LION QUALITY EVALUATION AND MONITORING</span>
        <div class="notification-bell" id="notificationBell">
            <i class="fas fa-bell"></i>
            <span class="badge hidden" id="notificationBadge">0</span>
        </div>
    </div>

    <nav class="main-nav" id="mainNav">
        <div class="sidebar">
            <ul>
                <li class="nav-tab" data-roles="Admin,Reviewer,Agent"><a href="index.html" id="auditFormTab" aria-label="Evaluation Form"><i class="fas fa-file-alt"></i> Evaluation Form</a></li>
                <li class="nav-tab" data-roles="Admin,Reviewer"><a href="index.html#database" id="databaseTab" aria-label="Database"><i class="fas fa-database"></i> Database</a></li>
                <li class="nav-tab" data-roles="Admin,Reviewer,Agent"><a href="#" id="myEvaluationsTab" class="active" aria-label="My Evaluations"><i class="fas fa-user-check"></i> My Evaluations</a></li>
                <li class="nav-tab" data-roles="Admin,Reviewer"><a href="Dashboard.html" id="reportsTab" aria-label="Dashboard"><i class="fas fa-chart-bar"></i> Dashboard</a></li>
                <li class="nav-tab" data-roles="Admin"><a href="autofails.html" id="autofailsTab" aria-label="Autofails"><i class="fas fa-exclamation-triangle"></i> Autofails</a></li>
                <li class="nav-tab" data-roles="Admin,Reviewer"><a href="index.html#shareResponse" id="shareResponseTab" aria-label="Share Response"><i class="fas fa-share-square"></i> Share Response</a></li>
                <li class="nav-tab" data-roles="Admin"><a href="users.html" id="usersTab" aria-label="Users"><i class="fas fa-users"></i> Users</a></li>
                <li class="nav-tab" data-roles="Admin"><a href="admin.html" id="adminTab" aria-label="Admin"><i class="fas fa-user-cog"></i> Admin</a></li>
                <li class="nav-tab" data-roles="Admin"><a href="images.html" id="imagesTab" aria-label="Images"><i class="fas fa-image"></i> Images</a></li>
            </ul>
            <button id="logoutBtn" class="logout-button" aria-label="Logout">Logout</button>
        </div>
    </nav>
    
    <div class="main-content-container" id="myEvaluationsContent">
        <div class="icealion-blue p-4 text-xl font-semibold text-center">
            My Evaluations
        </div>
        <div class="p-6">
            <div class="my-evaluations-card">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">Evaluations I Have Done</h2>
                <div class="table-container">
                    <table id="evaluationsDoneTable" class="min-w-full">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Contact ID</th>
                                <th>CER Name</th>
                                <th>Score</th>
                            </tr>
                        </thead>
                        <tbody id="evaluationsDoneTableBody">
                            <tr>
                                <td colspan="4" class="text-center py-4 text-gray-500">Loading evaluations...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="my-evaluations-card mt-6">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">My QA Audit Scores</h2>
                <div class="table-container">
                    <table id="myScoresTable" class="min-w-full">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Reviewer</th>
                                <th>Contact ID</th>
                                <th>Score</th>
                            </tr>
                        </thead>
                        <tbody id="myScoresTableBody">
                            <tr>
                                <td colspan="4" class="text-center py-4 text-gray-500">Loading scores...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="my-evaluations-card mt-6">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">My Monthly Average Score</h2>
                <div class="chart-container" style="position: relative; height:400px; width:100%">
                    <canvas id="myScoresChart"></canvas>
                </div>
            </div>

            <div class="my-evaluations-card mt-6">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">Autofail Areas by Month</h2>
                <div class="table-container">
                    <table id="autofailCountTable" class="min-w-full">
                        <thead>
                            <tr></tr>
                        </thead>
                        <tbody id="autofailCountTableBody">
                            <tr>
                                <td colspan="1" class="text-center py-4 text-gray-500">Loading data...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/10.0.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.0.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.0.0/firebase-firestore.js"></script>
    <script type="module" src="my-evaluations-logic.js"></script>
</body>
</html>
